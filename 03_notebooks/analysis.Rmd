---
title: Concurrent validity of an Estimator of Weekly Alcohol Consumption (EWAC) based
  on the Extended AUDIT
bibliography: bibliography.bib
csl: elsevier-vancouver.csl
output:
  word_document:
    toc: yes
    reference_docx: template.docx
  pdf_document:
    citation_package: natbib
    df_print: kable
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
    toc: yes
  html_document:
    df_print: paged
    number_sections: yes
    toc: yes
link-citations: yes
always_allow_html: yes
---

<!--
add HSE yesterday method

-->

<!-- 
abstract	250
intro	539
methods	1334
results	1233
discussion	858
conclu	100
total	4214

-->


```{r loading data, include=F}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)

# Loading data
source("../01_src/functions.R")
# source("../01_src/filepaths.R")
source("../01_src/audit_weights.R")


knit_output_pdf <- F
if(knit_output_pdf){
  options(knitr.table.format = "pdf")
} else {
  options(knitr.table.format = "pandoc")
}


library(tidyverse)
library(knitr)
library(captioner)
library(kableExtra)
library(pROC)
library(MASS)
# library("scales")
# library("xtable")
library(stargazer)
library(spatstat)
library(ggplot2)
source("../01_src/stat_ecdf_weighted.R")

auditx_labels <- c("audit1_label", "audit2_label", "audit3_label")

load(file.path("..", "02_data", "HSE.rda"))
load(file.path("..", "02_data", "ATS.rda"))
# Too small a sample size too manage
ats$sex[ats$sex == "In another way"] <- NA
ats <- ats %>% 
  mutate(., 
    audit1_label = if_else(.$audit1_label %in% c("Refused", "Don't know"), 
                           NA_character_, audit1_label),
    audit2_label = if_else(.$audit2_label %in% c("Refused", "Don't know"), 
                           NA_character_, audit2_label),
    audit3_label = if_else(.$audit3_label %in% c("Refused", "Don't know"), 
                           NA_character_, audit3_label))

# Alcohol retail data from PHE 2017
alcohol_sales_2014_liters <- 361429387
alcohol_pcapita_adults_2014_units <-  16.3 # per capita for all population
alcohol_pcapita_drinker_2014_units <- 19.3 # per capita for drinkers only
MYPE_2014 <- 42724917 # population aged 18+

# Sample sizes
n_ats <- nrow(ats)
valid_n_study1a <-  nrow(na.omit(ats[, c("gfmeanweekly", "audit1", "audit2", "audit3")]))
valid_n_study1b <-  nrow(na.omit(dplyr::select(ats, audit1_label, audit2_label, audit3_label, gfmeanweekly,
                           sex, ageg7, ethgrp, religion, highqual, smokstat)))
valid_n_study1c <- nrow(na.omit(dplyr::select(
    filter(ats, auditc >= 5 | fullaudit >=8), 
    audit1_label, audit2_label, audit3_label, gfmeanweekly,
         sex, ageg7, ethgrp, favdrink, tryalclyc2, 
         religion, highqual, smokstat)))

table_nums <- captioner::captioner(prefix = "Table")
tab_comparison_schedules <- table_nums(
  name = "tab_comparison_schedules",
  caption = "Alcohol schedules: selective comparison")
tab_overview_datasets <- table_nums(
  name = "tab_overview_datasets",
  caption = "Description of data sources")
tab_ats_rmsd_quantiles <- table_nums(
  name = "tab_ats_rmsd_quantiles",
  caption = paste0("Percentiles of the absolute deviation between EWAC and GF schedule (n = ", formatbm(valid_n_study1a), ")"))
tab_study1_roc112 <- table_nums(
  name = "tab_study1_roc112",
  caption = paste0("Receiver operating characteristics of AUDIT-C score and EWAC for consumption >= 14 UK units or 112g/week (n = ", formatbm(valid_n_study1a), ")"))
tab_study1_roc280 <- table_nums(
  name = "tab_study1_roc280",
  caption = paste0("Receiver operating characteristics of AUDIT-C score and EWAC for consumption >= 35 UK units or 280g/week (n = ", formatbm(valid_n_study1a), ")"))
tab_aggregate_summary_stats <- table_nums(
  name = "tab_aggregate_summary_stats",
  caption = "Summary statistics on alcohol consumption in England in residents aged 18 years and over (excluding abstainers)")

tab_hosp_validity_reg <- table_nums(
  name = "tab_hosp_validity_reg",
  caption = "Coefficients of regression of TLFB daily consumption against EWAC, administration of the week, week day and time")
tab_ewac_validity_reg <- table_nums(
  name = "tab_ewac_validity_reg",
  caption = paste0("Coefficients of linear regression of the bias and error of EWAC compared with GF in all respondents (n = ", formatbm(valid_n_study1b), ")"))
tab_ewac_validity_reg <- table_nums(
  name = "tab_ewac_validity_reg_increasedrisk",
  caption = paste0("Coefficients of linear regression of the bias and error of EWAC compared with GF in respondents with a hazardous/harmful alcohol use (AUDIT-C>=5 or AUDIT>=8; (n = ", formatbm(valid_n_study1c), ")"))


fig_nums <- captioner(prefix = "Figure")
fig_scatter_ats <- fig_nums(
  name = 'fig_scatter_ats',
  caption = 'Plots of EWAC against GF in (a) low/increasing risk ATS respondents (n=21,338) and (b) all ATS respondents (n=22,373)')
fig_ewac_MD_forest_plot <- fig_nums(
  name = 'fig_ewac_MD_forest_plot',
  caption = 'Forest plot of modelled MD for selected subgroups')
fig_ewac_RMSD_forest_plot <- fig_nums(
  name = 'fig_ewac_RMSD_forest_plot',
  caption = 'Forest plot of RMSD ratio (selected subgroups to reference category)')
fig_ewac_RMSD_increasedrisk_forest_plot <- fig_nums(
  name = 'fig_ewac_RMSD_increasedrisk_forest_plot',
  caption = 'Forest plot of RMSD ratio (selected subgroups to reference category) in respondents with a hazardous/harmful alcohol use (AUDIT-C>=5 or AUDIT>=8')
fig_scatter_tlfb <- fig_nums(
  name = 'fig_scatter_tlfb',
  caption = 'Plot of EWAC estimates against TLFB estimates in hospital participants with lines of fit')
fig_ECDF<- fig_nums(
  name = 'fig_ECDF',
  caption = 'Empirical cumulative distribution function of weekly alcohol consumption in England according to four alcohol schedules in residents aged 18 years and over')


# Hospital data

load("../02_data/hospital.rda")
vname_audit_baseline <- c("audit1_bline", "audit2_bline", "audit3_bline")
vname_audit_fu <- c("audit1_fu", "audit2_fu", "audit3_fu")
qdata <- records$main %>% 
  filter( !(pid %in% 2002:2010 | pid %in% 1001:1003) ) %>% 
  mutate(audit2_bline = case_when(
    audit2_bline == "13-15" ~ "13 to 15",
    audit2_bline == "10-12" ~ "10 to 12",
    TRUE ~ audit2_bline),
  audit3_bline = case_when(
    audit3_bline == "Daily or almost Daily" ~ "Daily or almost daily",
    TRUE ~ audit3_bline
  ))
 
n_HOSP_recruited_self <- sum(qdata$q_admin_mode=="Self")
n_HOSP_recruited_researcher <- sum(qdata$q_admin_mode=="Researcher")
n_HOSP_missing_AUDIT <- sum(is.na(qdata$audit1_bline) | is.na(qdata$audit2_bline) | is.na(qdata$audit3_bline)) 

# Compute AUDIT-C scores
qdata$auditc_score <- proc_AUDIT_score(
  qdata[,vname_audit_baseline], audit_weights_version3)
qdata$auditc_risk <- proc_AUDIT_risk(qdata$auditc_score)

# Compute EWAC
qdata$ewac_mp <- proc_EWAC(qdata[,vname_audit_baseline],
                           audit_weights_midpoints, method = "qfv")
qdata$ewac_stan <- proc_EWAC(qdata[,vname_audit_baseline],
                            audit_weights_STAN, method = "qfv" )
tdata_b <- records$tlfb %>%
  filter(encounter == "Baseline" &
           pid %in% unique(qdata$pid) &
           days_since <= 28)

tdata_b <- merge(tdata_b, qdata, by = "pid", all.x = T) %>% 
  filter(!is.na(ewac_stan)) %>% 
  group_by(pid) %>% 
  mutate(n_valid_tlfb = sum(!is.na(alcunits))) %>% 
  ungroup()

n_HOSP_missingTLFB14 <- tdata_b %>% 
  filter(n_valid_tlfb < 14) %>% 
  distinct(pid) %>% 
  nrow()

tdata_b <- filter(tdata_b, n_valid_tlfb >= 14)
qdata <- filter(qdata, pid %in% unique(tdata_b$pid))
```


# Abstract

**Background and Aims:** To develop and validate an Estimator of Weekly Alcohol Consumption (EWAC) using information collected by the consumption questions of the Extended Alcohol Use Disorders Identification Tool (Extended AUDIT-C). The Extended AUDIT-C contains a greater range of response items to quantify drinking frequency and quantity than the AUDIT-C.

**Methods:** *Study 1* evaluates the concurrent validity of EWAC against Graduated-Frequency (GF) measurements in a sample of 22,404 English household residents, testing whether (a) the mean deviation (metric of bias) exceeded a target of 1 UK unit, and (b) the root mean squared deviation (metric of total error) exceeded 2 UK units. Receiver Operating Characteristics in predicting alcohol consumption in excess of 112g/week (14 UK units) and 280g/week (35 UK units) are compared in EWAC, AUDIT-C, and the full AUDIT. *Study 2* evaluates the concurrent validity of EWAC against 28-day Timeline Followback (TLFB) measurements in a sample of 98 outpatient clinic attendees in one UK hospital, and tests the administration mode effect on bias (self- vs researcher-administered). *Study 3* compares the EWAC's empirical distribution of alcohol consumption in England with other sources of data.  

**Results:** The EWAC estimates usual alcohol consumption with a positive bias of 0.2 UK units [95% confidence interval: 0.04, 0.3] and a total error of $\pm$ 11 UK units/week [9.8, 12.0] when compared to GF, or $\pm$ 5 UK units/week [3.9, 7.6] when compared to TLFB. 
No statistical evidence of an effect of self-administration on bias ($p$ = 0.399) was found.
The EWAC predicts alcohol consumption in excess of 112g/week with a significantly greater area under the curve (0.921 [0.917, 0.925]) than the AUDIT-C (0.871	[0.866, 0.876]) or the full AUDIT (0.854 [0.849, 0.860]). Similarly, the EWAC predicts consumption in excess of 280g/week with a significantly greater area under the curve (0.936 [0.929; 0.943]) than the AUDIT-C (0.913 [0.904, 0.921]) or the full AUDIT (0.901 [0.893; 0.909]).
*Studies 1-3* suggest that the EWAC may underestimate the alcohol consumption of higher-risk drinkers based on comparisons with other data sources.

**Conclusions:** The EWAC <URL TBC> provides greater screening specificity than the AUDIT-C or the full AUDIT. In addition, it can provide additional personalised information to patients in a more understandable and potentially less stigmatising way than AUDIT scores or risk categorisations. The EWAC has potential to generate personalised feedback within digital alcohol interventions.  

# Keywords

alcohol consumption; self report; alcohol use disorder; screening programs, diagnostic; preventive health services

# Introduction

Alcohol consumption is responsible for 5.3% of all deaths and 5.0% of disability-adjusted life years [@Shield2020]. This burden extends far beyond those categorised with *alcohol use disorders*, as defined in the International Statistical Classification of Diseases (ICD-10 F10.1/F10.2; ICD-11 QE10/6C40.1) or the Diagnostic and Statistical Manual of Mental Disorders. 

Clinical guidelines aim to prevent [@NICE-PH24], treat and reduce [@NICE-CG115] harm from alcohol consumption. Most recommend systematic screening for alcohol use disorders using a validated diagnostic tool. Recent clinical research has advocated a greater focus on monitoring  alcohol consumption in the same way as other health risk factors (eg body mass index, blood pressure or cholesterol), keeping individuals regularly informed of their current intake and the associated risks [@Nutt2014; @Rehm2016]. This approach is intended to facilitate timely lifestyle interventions to prevent the escalation to serious levels of alcohol-related harm. Simultaneously, public health recommendations [@AU.alcoguidelines2009; @AlcoholCMO2016b] now promote the overall reduction of alcohol consumption, since there is absolute 'safe level' at which alcohol does not increase general health risk [@Wood2018].

Assessment of alcohol consumption is not well embedded in clinical practice. Reasons include: difficulty in the self-assessment of alcohol consumption, lack of a single biological marker, time pressures, and stigma. This creates a gap in the range of resources to empower individuals to understand, monitor and control their alcohol consumption with--or without--the involvement of healthcare professionals.

The objective of this paper is to develop and validate a fast and easy-to-complete Estimator of Weekly Alcohol Consumption (EWAC) by repurposing an existing screening tool. In many countries, the most widely used screening tool is the Alcohol Use Disorders Identification Test (AUDIT) [@Babor2001], a 10-item questionnaire schedule employed in clinical practice and research as a diagnostic screening tool. The short, 3-item consumption questions known as AUDIT-C has good accuracy for both: (a) interview-based clinical diagnoses; and (b) consumption in excess of maximum recommended intakes (eg 140g/week in Australia, 112 g/week in UK) in a variety of populations [@DeMeneses-Gaya2009].

The present study aims to validate the EWAC against continuous measures of alcohol consumption, as opposed to against a particular clinical diagnosis or consumption threshold. To this end, we adopt a variant of the AUDIT-C schedule known as the ‘Extended AUDIT-C’, which improves the granularity of the information collected with a greater range of response options on quantity and frequency (AUDIT items 1 and 2). The Extended AUDIT-C has been used in UK research as part of two trials [@Kaner2013c; @Crane2018] and one continuous household survey [@Beard2015a] to capture greater information on the higher risk drinkers, based on the observation that AUDIT consumption response items are right-truncated.

This paper is made up of three investigations. Study 1 estimates coefficients to apply to each of the AUDIT-C response items to compute an EWAC using data from a large English household survey, the Alcohol Toolkit Study (ATS). It then tests the concurrent validity of the EWAC against Graduated-Frequency (GF) measurements across a number of demographic subpopulations in England. Study 2 tests the concurrent validity of the EWAC against the 28-day Timeline Followback (TLFB) in a clinical population (hospital clinic outpatients). Study 3 compares four sources of data (the EWAC, the ATS GF schedule, the Health Survey for England, and alcohol sales official statistics) on the population-wide cumulative distribution of alcohol consumption in England.


# Methods

## Approach 

This paper develops and validates an Estimator of usual Weekly Alcohol Consumption in units (EWAC) based on the Extended AUDIT-C. Neither the AUDIT-C nor the Extended AUDIT-C provide a direct measure of alcohol consumption. However, the product of frequency of drinking (AUDIT item 1) and quantity of drinking (AUDIT item 2) can be used to estimate usual alcohol consumption, with adjustment for occasional heavy use (AUDIT item 3), following methods developed for quantity-frequency-variability instruments [@Lemmens1992].

In practice, for every individual $i$, the EWAC is computed as the product of $F_i$ and $Q_i$ (AUDIT items 1 and 2 respectively) adjusted with the frequency of intense drinking $V_i$ (AUDIT item 3):

$$\text{EWAC}_i = F_i Q_i + V_ib$$

where $b$ denotes the average number of units of alcohol consumed in an intense drinking day. Coefficients $F, Q, V$ and $b$ are unknown. In this study, two sets of potential coefficients are evaluated using:

- the AUDIT response item interval midpoint: for example, 2.5 for '2 to 3 times per week' in AUDIT item 2
- a statistical model to estimate the coefficients empirically from alcohol consumption data

All results are reported in UK alcohol units (8g or 10mL of pure alcohol).  Analyses are conducted in `R` [@RCoreTeam2017] using packages `tidyverse` and `rstan` [@package-tidyverse; @package-rstan]. Computer scripts for all analyses are available online [@Dutey2020]. <SUBMIT ZENODO BEFORE SUBMISSION>

## Data sources

A longstanding obstacle in alcohol research and treatment is that there is no undisputed 'gold standard' or biomarker for assessing the level and duration of alcohol consumption. Instead, a number of instruments exist which measure self-reported alcohol consumption with varying validity and reliability over different time periods. A comprehensive review of these is summarised in `r table_nums("tab_comparison_schedules", display = "cite")` below. Prospective diaries tend to record higher alcohol consumption by minimising recall bias, followed by GF, while lower levels seem to be recorded with QF measures [@Heeb2005; @Rehm1998].

`r table_nums("tab_comparison_schedules")`

```{r table_comparison_schedules, fig.cap = tab_comparison_schedules, message=F}
readr::read_csv("table_overview_schedules.csv")  %>% 
  kable(., format = ifelse(knit_output_pdf, "latex", "html")) %>% 
  kable_styling()
```

`r table_nums("tab_overview_datasets", display = "cite")` summarises the four data sources used in this paper alongside references to methodological descriptions.

`r table_nums("tab_overview_datasets")`

|	Source	|	Time	|	Study population |	Measurements |	Validation	|	Sample size	|	Design	|
|	-------------	|	-------------	|	-------------	|	-------------	|	-------------	|	------:	|	-------------	|
|	Alcohol Toolkit Study (ATS) [@Beard2015a]	|	November 2015--October 2017 (waves 110--133)	|	Residents of private English households aged 16 years and over	|	Interviewer-led Extended AUDIT-C and GF	|	@Heeb2005, @Greenfield2009	|	40,832	|	Cross-sectional sample survey	|
|	Health Survey for England (HSE) [@NatCenSocialResearch2013]	|	2011	|	Residents of private English households aged 16 years and over	|	Interviewer-led beverage-specific QF	|	Consistent with a prospective diary [@Boniface2014] and yesterday recall [@Stockwell2016].	|	8,610	|	Cross-sectional sample survey	|
|	Hospital questionnaire study (HOSP)	|	February 2019--October 2019	|	Outpatient and day case hospital patients aged 18 years and over	|	Interviewer/self-administered Extended AUDIT-C and interviewer-led TLFB	|	TLFB records fewer drinking days and thus lower consumption than a prospective diary [@Grant1995]. This recall bias increases with the number of days elapsed [@Hoeppner2010; @Vinson2003]	|	`r nrow(qdata)`	|	Cross-sectional study with block randomisation to (a) self-administered AUDIT or (b) researcher-administered AUDIT.	|
|	Alcohol retail sales [@PHE2017]	|	2014	|	English population aged 18 years and over	|	--	|	@PHE2017	|	-- |	Ratio of all alcohol produced or processed in the UK, as well as alcohol imported into the UK for sale and consumption, over the mid-year population estimate	|


## Study 1: EWAC estimation and concurrent validity

Study 1 evaluates the accuracy of the EWAC derived from a researcher-administered Extended AUDIT-C in community households. A pre-registered protocol for this study is available online [@Dutey2018]. It uses the GF schedule from the ATS as the reference standard. Two sets of coefficients are compared: AUDIT response item interval midpoint; and coefficients estimated using a statistical model (supplementary material 1-2).

First, the agreement between the EWAC and the GF is quantified by studying two types of deviations:

- bias is estimated using the **mean deviation** to the reference standard $\text{MD} = n^{-1} \sum_{i=1}^{n}{(\rm{EWAC}_i - \rm{GF}_i )}$. We test the hypothesis that the MD is greater than 1 UK unit using a two-sided $t$-test. 
- precision is estimated using the **root mean squared deviation** $\text{RMSD} = \sqrt{n^{-1} \sum_{i=1}^{n}{( \rm{EWAC}_i - \rm{GF}_i )^2}}$, a measure of total error: it captures both bias and random deviation from the reference standard. For example, an RMSD of 2 signifies that the EWAC is on average with $\pm$ 2 UK units of the gold standard. We test the hypothesis that the RMSD is greater than 2 UK units using a one-sided $\chi^2$ homogeneity test.

Second, we examine whether the EWAC's validity varies across population subgroups.

- the simple deviation $(\text{EWAC}-\text{GF})$ is regressed in a linear model to test for subgroup differences in MD
- the squared deviation $(\rm{EWAC}-\rm{GF})^2$ is regressed in a log-transformed linear model to test subgroup differences in the geometric mean squared deviation. Model coefficients are then transformed (square root of the exponential) into relative RMSD estimates interpreted as the ratio of the subgroup RMSD to the reference category RMSD, a ratio >1 indicating worse precision than in the reference category. 

Both models include the following predictors: sex by age group; ethnic group; highest educational qualification; religion; smoking status. Additional models are fitted solely in respondents with an AUDIT-C score of 5 or more or an AUDIT score of 8 or more (under the ICD terminology, hazardous and harmful alcohol use), using extra variables measures during interview: favourite drink (beer; wine; spirits alone; mixed spirits; cider; other); and whether the respondent had attempted to restrict alcohol intake in the last 12 months (eg by drinking less, choosing lower strength alcohol or using smaller glasses).

Third, we test whether the EWAC is superior to the traditional AUDIT and AUDIT-C scores at predicting drinking in excess of 14 or 35 UK units per week. In the UK, an AUDIT-C score of 5-7 is often categorised as 'increasing risk', and scores of 8 or more are categorised as 'higher risk' drinking [@Lavoie2010]. The study tests the hypothesis that the EWAC's receiver operating characteristics' full area under the curve (AUC) is greater that the comparators using nonparametric paired AUC tests [@Delong1988].

The ATS data ($n=$ `r formatbm(n_ats)`) is affected by missing data: `r round(mean(ats$audit1 == 1)*100)`% of respondents ($n=$ `r formatbm(sum(ats$audit1 == 1))`) reported never drinking alcohol in AUDIT item 1 and were not asked any further AUDIT or GF questions. These participants are excluded from the analysis. A further `r formatbm(sum(ats$audit1 != 1 & is.na(ats$gfmeanweekly)))` respondents (`r tbrounding(sum(ats$audit1 != 1 & is.na(ats$gfmeanweekly))/sum(ats$audit1 != 1))`% of those reporting drinking in AUDIT item 1) did not have a valid GF alcohol consumption record and were also excluded. In total, `r formatbm(valid_n_study1a)` valid observations remain for the diagnostic analysis, in which missing GF data is assumed to be missing at random conditionally on the Extended AUDIT-C responses. In the subgroup analysis (Study 2 below), a further `r formatbm(valid_n_study1a-valid_n_study1b)` repondents (`r tbrounding(valid_n_study1b/n_ats)`%) were assumed to have data missing at random and were excluded.

## Study 2: Concurrent validity in hospital outpatients

Study 2 aims to confirm the robustness of findings (a) in a clinical population; (b) when the Extended AUDIT-C is self-administered; (c) using a different reference standard: the 28-day TLFB. A pilot study recruited participants prospectively from a range of clinics (endoscopy day cases, outpatient orthopaedics, ophthalmology, rheumatology, young adults, and managed care clinics) at a large acute hospital in Southampton, UK, until a target minimum of 100 participants provided usable data on the Extended AUDIT-C. A total of `r n_HOSP_recruited_self+n_HOSP_recruited_researcher` participants consented to participating, and block-randomised to one of two groups:

(1) self-administered Extended AUDIT-C (n=`r n_HOSP_recruited_self`)
(2) researcher-administered Extended AUDIT-C (n=`r n_HOSP_recruited_researcher`).

Once the Extended AUDIT-C was complete, both groups were administered a 28-day TFLB by the researcher. 

A total of `r n_HOSP_missing_AUDIT` participants (`r round(n_HOSP_missing_AUDIT / (n_HOSP_recruited_self + n_HOSP_recruited_researcher) *100)`%) did not complete the Extended AUDIT-C successfully and were excluded from the analysis. A further `r n_HOSP_missingTLFB14` participants who had not provided consumption estimates for at least 14 days were also excluded. Out of `r nrow(qdata)`  participants included in the analysis, 
`r nrow(qdata)-as.numeric(summarise(filter(tdata_b, is.na(alcunits)), n_distinct(pid)))` completed all 28 days of the TLFB successfully. Just `r round(mean(is.na(tdata_b$alcunits))*100, 0)`% (`r sum(is.na(tdata_b$alcunits))`/`r nrow(tdata_b)`) of all daily measures were missing.

For each participant, the mean of TLFB daily measures was multiplied by 7 to compute a weekly average consumption and compared with the EWAC using identical tests as in Study 1. Next, we estimated the effect of the mode of administration (self vs researcher-administered) on MD, and tested the null hypothesis $(H_0): MD_{self} - MD_{researcher} = 0$. With an RMSD of 6, a sample of n = `r round(power.t.test(delta = 3.5, sd = 6, power = .8, sig.level = .05)$n+.5)` within each administration group is sufficient to detect an effect of at least 3.5 UK units (28g) with 80% power and 95% confidence using a two-sided independent groups *t*-test.

## Study 3: Aggregate concurrent validity

Study 3 examines the consistency in aggregate alcohol consumption estimates across England in residents aged 18 years and over. We plot the empirical cumulative distributions of alcohol consumption given by (1) the EWAC estimated from the ATS; (2) the quantity-frequency estimated in the ATS; (3) the beverage-specific estimators in HSE in 2011; (4) the prospective diary estimator in HSE 2011. In this analysis, survey weights are used: in (1-3), poststratification weights estimated using calibration and age-sex mid-year population estimates; in (4), similar poststratification weights adjusted for self-selection into participation to the prospective diary data collection. We report the percentage of total alcohol sales for England accounted for by each method, using both on-trade and off-trade 2014 sales estimates for England from @PHE2017.

# Results

```{r}

ats$ewac_mp <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_midpoints, method = "qfv")
ats$ewac_qf <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN, method = "qf")
ats$ewac_qfv <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN, method = "qfv")
ats$ewac_qb <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN, method = "qb")
ats$ewac_qv <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN, method = "qv")
ats$ewac_qfv_M <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN_men, method = "qfv")
ats$ewac_qfv_F <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN_women, method = "qfv")
ats <- mutate(ats, ewac_qfv_S = if_else(sex == "Men", 
                                        ewac_qfv_M, ewac_qfv_F))

ats$ewac_best <- data.frame(list(ats$gfmeanweekly - ats$ewac_qf, ats$gfmeanweekly - ats$ewac_qv, ats$gfmeanweekly - ats$ewac_qfv, ats$gfmeanweekly - ats$ewac_qb)) %>% 
  apply(., 1, function(X) if(length(which.min(abs(X)))==0) NA else which.min(abs(X))) 

ats$ewac_best<- factor(ats$ewac_best, labels = c("qf", "qv", "qfv", "qb"))


test_midpoint <- list(
  MD = mean(ats$ewac_mp - ats$gfmeanweekly, na.rm = T),
  MD.ME = 1.96 * sqrt(var(ats$ewac_mp - ats$gfmeanweekly, na.rm = T) / (
    length(na.omit(ats$ewac_mp - ats$gfmeanweekly)) - 1)),
  MD.p = t.test.MD(ats$ewac_mp - ats$gfmeanweekly)$p.value,
  RMSD = sqrt(mean((ats$ewac_mp - ats$gfmeanweekly)^2, na.rm = T)),
  MSD = (mean((ats$ewac_mp - ats$gfmeanweekly)^2, na.rm = T)),
  MSD.ME = 1.96 * sqrt(var((ats$ewac_mp - ats$gfmeanweekly)^2, na.rm = T) / (
    length(na.omit(ats$ewac_mp - ats$gfmeanweekly))) - 1 ),
  RMSD.p = t.test( (ats$ewac_mp - ats$gfmeanweekly)^2, mu = 4)$p.value
)

test_stan <- list(
  MD = mean(ats$ewac_qfv - ats$gfmeanweekly, na.rm = T),
  MD.ME = 1.96 * sqrt(var(ats$ewac_qfv - ats$gfmeanweekly, na.rm = T) / (
    length(na.omit(ats$ewac_qfv - ats$gfmeanweekly)) - 1)),
  MD.p = t.test.MD(ats$ewac_qfv - ats$gfmeanweekly)$p.value,
  MSD = (mean((ats$ewac_qfv - ats$gfmeanweekly)^2, na.rm = T)),
  MSD.ME = 1.96 * sqrt(var((ats$ewac_qfv - ats$gfmeanweekly)^2, na.rm = T) / (
  length(na.omit(ats$ewac_qfv - ats$gfmeanweekly))) - 1 ),
  RMSD = sqrt(mean((ats$ewac_qfv - ats$gfmeanweekly)^2, na.rm = T)),
  RMSD.p = chisq.test.variance( (ats$ewac_qfv - ats$gfmeanweekly)^2,
                                sigma = 4)$p.value
)

test_stan_S <- list(
  MD = mean(ats$ewac_qfv_S - ats$gfmeanweekly, na.rm = T),
  MD.p = t.test.MD(ats$ewac_qfv_S - ats$gfmeanweekly)$p.value,
  RMSD = sqrt(mean((ats$ewac_qfv_S - ats$gfmeanweekly)^2, na.rm = T)),
  RMSD.p = chisq.test.variance( (ats$ewac_qfv_S - ats$gfmeanweekly)^2,
                                sigma = 4)$p.value
)

stan_qfv_S_men <- ats %>% 
  filter(sex == "Men") %>% 
  summarise(MD = mean(ewac_qfv_S - gfmeanweekly, na.rm = T),
            MD.p = t.test.MD(ewac_qfv_S - gfmeanweekly)$p.value,
            RMSD = sqrt(mean((ewac_qfv_S - gfmeanweekly)^2, na.rm = T)),
            RMSD.p = chisq.test.variance((ewac_qfv_S - gfmeanweekly)^2,
                                         sigma = 4)$p.value) 
stan_qfv_S_women <- ats %>% 
  filter(sex == "Women") %>% 
  summarise(MD = mean(ewac_qfv_S - gfmeanweekly, na.rm = T),
            MD.p = t.test.MD(ewac_qfv_S - gfmeanweekly)$p.value,
            RMSD = sqrt(mean((ewac_qfv_S - gfmeanweekly)^2, na.rm = T)),
            RMSD.p = chisq.test.variance((ewac_qfv_S - gfmeanweekly)^2,
                                         sigma = 4)$p.value)

```

## Study 1: EWAC estimation and validation

### Overall bias and accuracy

The first step involved choosing a set of coefficients to compute the EWAC (supplementary materials 1--2).

The EWAC computed with the midpoint of the AUDIT item intervals had a Pearson's correlation $r$ = `r tbrounding(cor.test(ats$gfmeanweekly, ats$ewac_mp, use = "complete.obs")$estimate, 2)` [95% CI: `r paste(tbrounding(cor.test(ats$gfmeanweekly, ats$ewac_mp, use = "complete.obs")$conf.int, 2), collapse = ", ")`]. It produced a mean deviation (MD) of `r tbrounding(test_midpoint$MD, 1)` UK alcohol units/week  [95% CI: `r round(test_midpoint$MD - test_midpoint$MD.ME, 1)`, `r round(test_midpoint$MD + test_midpoint$MD.ME, 1)`]. This bias is smaller than the preregistered $\pm$ 1-unit bias tolerance (`r pvrounding(test_midpoint$MD.p)`). The root mean squared deviation (RMSD) estimate of `r tbrounding(test_midpoint$RMSD, 1)` units [95% CI: `r round(sqrt(test_midpoint$MSD - test_midpoint$MSD.ME), 1)`, `r round(sqrt(test_midpoint$MSD + test_midpoint$MSD.ME), 1)`] was significantly greater than the pre-registered 2-unit total error tolerance (`r pvrounding(test_midpoint$RMSD.p)`).

Coefficients estimated empirically (statistical model reported in supplementary materials 2) provided a small improvement: $r$ = `r tbrounding(cor.test(ats$gfmeanweekly, ats$ewac_qfv, use = "complete.obs")$estimate,2)` [`r paste(tbrounding(cor.test(ats$gfmeanweekly, ats$ewac_qfv, use = "complete.obs")$conf.int, 2), collapse = ", ")`] (Kendall's rank correlation $\tau$ = .63) and MD = `r tbrounding(test_stan$MD, 1)` [95% CI: `r round(test_stan$MD - test_stan$MD.ME, 2)`, `r round(test_stan$MD + test_stan$MD.ME, 1)`] (`r pvrounding(test_stan$MD.p)`). With RMSD = `r tbrounding(test_stan$RMSD, 1)` [95% CI: `r tbrounding(sqrt(test_stan$MSD - test_stan$MSD.ME), 1)`, `r tbrounding(sqrt(test_stan$MSD + test_stan$MSD.ME), 1)`], precision remained statistically significantly greater than 2 (`r pvrounding(test_stan$RMSD.p)`), suggesting that the EWAC falls on average 11 units away from the GF reference standard..

The RMSD masked a dispersed and skewed distribution of error. `r table_nums('tab_ats_rmsd_quantiles', display = "cite")` shows that, for 50% of participants, the EWAC fell within $\pm$ 2 UK units of the GF weekly consumption estimate. Thus, an interval estimate defined as the EWAC $\pm$ 2 units (eg '10 to 14 units') would contain the reference standard for half of individuals, while an interval estimate defined as the EWAC $\pm$ 3 units (eg '9 to 15 units') would contain the reference standard for 60% of individuals. 

`r table_nums('tab_ats_rmsd_quantiles')`

```{r ats_rmsd_quantiles}
t(tbrounding(quantile(na.omit(abs(ats$ewac_qfv - ats$gfmeanweekly)), probs = c(seq(.1, .9, .1), .95, .99)), 1)) %>% kable()
```


`r fig_nums("fig_scatter_ats", display = "cite")` compares individual EWAC and GF values. Lines of best fit depart from the diagonal, demonstrating the EWAC's small positive bias (MD > 0) is not consistent. The plots indicate a slight positive bias for consumptions up to 10-14 units/week, then a slight negative bias above this threshold.


```{r ewac_benchmark}
ats$ewac_qfv_bench <- ats$ewac_qfv * 0.8997 + 0.8344

stan_qfv_bench <- ats %>% 
  summarise(MD = mean(ewac_qfv_bench - gfmeanweekly, na.rm = T),
            RMSD = sqrt(mean((ewac_qfv_bench - gfmeanweekly)^2, na.rm = T)),
            RMSD.p = chisq.test.variance((ewac_qfv_bench - gfmeanweekly)^2,
                                         sigma = 4)$p.value)
```



```{r warning=F, fig.height=5, fig.width=10}
scatterplot_1 <- dplyr::select(ats, gfmeanweekly, ewac_qfv) %>% 
  na.omit %>% 
  ggplot(mapping = aes(x = gfmeanweekly, y = ewac_qfv)) +
  geom_point(alpha = .1) +
  geom_abline(aes(intercept = 0, slope = 1, col = "Identity", linetype = "Identity")) +
  geom_smooth(aes(col="OLS", linetype = "OLS"), method ='lm', formula=y~x) +
  geom_smooth(aes(col="Spline", linetype = "Spline"), 
              method = 'gam', formula = y~s(x, bs="ts")) +
  scale_colour_manual(name="Line of fit",
    values = c("Identity" = "black", "OLS" = "blue", "Spline" = "red")) +
  scale_linetype_manual(name="Line of fit",
    values = c("Identity" = "solid", "OLS" = "longdash", "Spline" = "dotted")) +
  ylab("EWAC (UK units/week)") +
  xlab("Graduated-Frequency schedule (UK units/week)") +
  coord_equal() +
  geom_hline(yintercept = 14, color = "grey50") + 
  geom_vline(xintercept = 14, color = "grey50") +
  theme_bw()

scatterplot_1b <- scatterplot_1 +
  geom_rect(aes(xmin = 0, ymin = 0, xmax = 36, ymax = 36), fill = "#faf207") +
  geom_point(alpha = .1)+
  scale_x_continuous(breaks = seq(0, 150, 10), limits = c(0, 150), minor_breaks = F)+
  scale_y_continuous(breaks = seq(0, 150, 10), limits = c(0, 150), minor_breaks = F)+
  ggtitle("(b)")

scatterplot_1a <- scatterplot_1 +
  theme(panel.background = element_rect(fill = "#faf207"),
        panel.grid = element_line(colour = "white")) +
 scale_x_continuous(breaks = seq(0, 150, 2), limits = c(0, 35), minor_breaks = F)+
 scale_y_continuous(breaks = seq(0, 150, 2), limits = c(0, 35), minor_breaks = F)+
  ggtitle("(a)")

ggpubr::ggarrange(scatterplot_1a, scatterplot_1b, ncol = 2, nrow = 1)
```

 `r fig_nums('fig_scatter_ats')`


### Subgroup accuracy

```{r ewac_subgroup_regressions}
ats <- mutate(ats, f_ageg = relevel(ageg7, ref = "25-34 years"))

lm_bias_stan <- lm((ewac_qfv-gfmeanweekly) ~ sex*f_ageg + ethgrp +  
                    religion + highqual  + smokstat, data = ats)
lm_rmsd_stan <- lm(log((ewac_qfv-gfmeanweekly)^2) ~ sex*f_ageg + ethgrp +  
                    religion + highqual + smokstat, data = ats)
lm_bias_increasingrisk <- lm((ewac_qfv-gfmeanweekly) ~ sex*f_ageg + ethgrp + 
                   religion + highqual + smokstat + favdrink + tryalclyc2, 
                   data = filter(ats, auditc >= 5 | fullaudit >=8))
lm_rmsd_increasingrisk <- lm(log((ewac_qfv-gfmeanweekly)^2) ~ sex*f_ageg + ethgrp + 
                   religion + highqual + smokstat + favdrink + tryalclyc2, 
                   data = filter(ats, auditc >= 5 | fullaudit >=8))
```

Next, the MD and RMSD were regressed against respondent characteristics in order to identify subgroups with heterogeneous bias or precision (supplementary material 3, `r table_nums("tab_ewac_validity_reg", display = "cite")`). The reference category's key characteristics are: females aged between 25 and 34 years of White ethnicity without educational qualifications, who never smoked. The model predictors explain a very modest proportion of both MD and RMSD ($R^2$ statistics < 2%). Nevertheless, specific subgroups do exhibit very different MD and RMSD.

`r fig_nums('fig_ewac_RD_forest_plot', display = "cite")` summarises the MD for a selection of subgroups whose predicted MD was either above 1 or below -1; and whose coefficients had a $p$-value below 0.05. Respondents of Black, Other, and White Other ethnic groups had significantly overestimated EWACs: their MDs were respectively 4.8 units [95% CI: 2.1, 7.5]; 5.9 units [1.6, 10.1] and 1.6 [0.2, 3.0] in excess of the reference MD. The MDs of respondents aged 55 to 64 years, or 75 years and over respectively had MDs 2.2 units [0.5; 3.9] and 4.2 units [0.9; 7.6] in excess of the reference MD. Similar results were found in increasing risk drinkers, without significant evidence of an effect of favourite drink or attempts to reduce alcohol intake in the past year (supplementary material 3, `r table_nums("tab_ewac_validity_reg_increasedrisk", display = "cite")`)

```{r ewac_subgroup_bias, fig.width=7, fig.height=3}
ewac_bias_plot <- as_tibble(summary(lm_bias_stan)$coefficients)
ewac_bias_plot <- ewac_bias_plot %>% 
  mutate(Variable = names(lm_bias_stan$coefficients),
         MD = lm_bias_stan$coefficients[1] + Estimate) %>% 
  filter(abs(MD)>=1 & `Pr(>|t|)` < 0.05) %>% 
  arrange(-Estimate) %>% 
  mutate(x = rank(Estimate))
  
labs <- ewac_bias_plot$Variable
names(labs) <- as.character(length(labs):1)

ggplot(ewac_bias_plot, aes(x = factor(x), y = MD)) +
  scale_x_discrete(breaks = names(labs), 
                   labels = labs, name = NULL)+
  scale_y_continuous(breaks = -10:16, name = "Predicted MD (UK units/week)")+
  coord_flip() +
  geom_linerange(aes(ymin = MD - 1.96*`Std. Error`, ymax = MD + 1.96*`Std. Error`), 
                 colour = "purple") +
  geom_point() +
  geom_text(aes(label = round(MD, 1)), vjust = 1.2) +
  geom_hline(aes(yintercept = 0)) +
  geom_segment(aes(x = "0", xend = "0", y =0, yend = 2), 
               lwd = 1, arrow = arrow(length = unit(0.03, "npc"))) +
  geom_label(aes(x = "0", y = 2.1, label = "EWAC overestimates consumption"),
             hjust = "inward", colour = "purple") +
  theme_minimal() 

```

`r fig_nums('fig_ewac_MD_forest_plot')` 

`r fig_nums('fig_ewac_RMSD_forest_plot', display = "cite")` shows those subgroups with an RMSD found to be significantly different from the rest of the population ($p < 0.05$); and estimated to be 20% greater or smaller than the RMSD of the reference category. This shows that RMSD is 58% [95% CI: 50; 67%] greater in current smokers, 34% [14; 56%] greater in respondents who stopped smoking in the past year, and 23% greater [17; 30%] in respondents who stopped smoking over a year ago. It is also 44% greater [29; 60%] greater in men and 34% greater [19; 50%] in respondents aged 16 to 24 years. Conversely, error is 35 to 70% smaller in White Other, Black and Other ethnic groups.

```{r ewac_subgroup_error, fig.width=9, fig.height=3}
ewac_error_plot <- as_tibble(summary(lm_rmsd_stan)$coefficients)
ewac_error_plot <- ewac_error_plot %>% 
  mutate(Variable = names(lm_rmsd_stan$coefficients),
         RMSD_ratio = sqrt(exp(Estimate))) %>% 
  mutate(RMSD_ratio_LB = sqrt(exp(Estimate - (1.96*`Std. Error`))),
         RMSD_ratio_UB = sqrt(exp(Estimate + (1.96*`Std. Error`)))) %>% 
  filter(abs(Estimate)>=log(1.2^2) & `Pr(>|t|)` < 0.05 & Variable != "(Intercept)") %>% 
  arrange(-RMSD_ratio) %>% 
  mutate(x = formatC(rank(RMSD_ratio)+1, width = 2, format = "d", flag = "0"))
  
labs2 <- ewac_error_plot$Variable
names(labs2) <- as.character(ewac_error_plot$x)

ggplot(ewac_error_plot, aes(x = factor(x), y = RMSD_ratio)) +
  scale_x_discrete(breaks = names(labs2), 
                   labels = labs2, name = NULL)+
  scale_y_continuous(breaks = seq(0, 4, .1),
                     "Relative RMSD (1.0 = reference category)")+
  coord_flip() +
  geom_text(aes(label = round(RMSD_ratio, 1)), vjust = 1.2) +
  geom_linerange(aes(ymin = RMSD_ratio_LB, ymax = RMSD_ratio_UB), colour = "purple") +
    geom_point() +
  geom_hline(aes(yintercept = 1)) +
  geom_segment(aes(x = "00", xend = "00", y =1, yend =1.25), 
               lwd = 1, arrow = arrow(length = unit(0.03, "npc"))) +
  geom_label(aes(x = "00", y = 1.01, label = "Worse agreement of EWAC\n with reference standard"),
             hjust = "inward", vjust= -0.2, colour = "purple") +
  theme_minimal() 
```

`r fig_nums('fig_ewac_RMSD_forest_plot')`

`r fig_nums('fig_ewac_RMSD_increasedrisk_forest_plot', display = "cite")` visualises the same analysis in increasing risk drinkers exclusively (AUDIT-C $\geq$ 5 or AUDIT $\geq$ 8). With a higher mean alcohol consumption, results differ from the overall picture presented in `r fig_nums('fig_ewac_RMSD_forest_plot', display = "cite")`. The RMSD of respondents favouring mixed spirits had an RMSD 23% [95% CI: 9.6; 38] smaller than the reference category.  Educational qualifications seem to significantly improve the agreement between EWAC and the reference standard. School and degree-level qualifications reduced RMSD by 24% [12; 37%] and 37% [23; 52%] smaller respectively with unchanged MD, suggesting that respondents may have better recall and clarity over alcohol beverage content. Conversely, the RMSD of respondents who attempted to reduce their alcohol consumption was 23% [16; 30%] larger than the reference category.

```{r ewac_subgroup_error_increasedrisk, fig.width=9, fig.height=3}
ewac_error_plot <- as_tibble(summary(lm_rmsd_increasingrisk)$coefficients)
ewac_error_plot <- ewac_error_plot %>% 
  mutate(Variable = names(lm_rmsd_increasingrisk$coefficients),
         RMSD_ratio = sqrt(exp(Estimate))) %>% 
  mutate(RMSD_ratio_LB = sqrt(exp(Estimate - (1.96*`Std. Error`))),
         RMSD_ratio_UB = sqrt(exp(Estimate + (1.96*`Std. Error`)))) %>% 
  filter(abs(Estimate)>=log(1.2^2) & `Pr(>|t|)` < 0.05 & Variable != "(Intercept)") %>% 
  arrange(-RMSD_ratio) %>% 
  mutate(x = formatC(rank(RMSD_ratio)+1, width = 2, format = "d", flag = "0"))
  
labs2 <- ewac_error_plot$Variable
names(labs2) <- as.character(ewac_error_plot$x)

ggplot(ewac_error_plot, aes(x = factor(x), y = RMSD_ratio)) +
  scale_x_discrete(breaks = names(labs2), 
                   labels = labs2, name = NULL)+
  scale_y_continuous(breaks = seq(0, 4, .1),
                     "Relative RMSD (1.0 = reference category)")+
  coord_flip() +
  geom_text(aes(label = round(RMSD_ratio, 1)), vjust = 1.2) +
  geom_linerange(aes(ymin = RMSD_ratio_LB, ymax = RMSD_ratio_UB), colour = "purple") +
    geom_point() +
  geom_hline(aes(yintercept = 1)) +
  geom_segment(aes(x = "00", xend = "00", y =1, yend =1.25), 
               lwd = 1, arrow = arrow(length = unit(0.03, "npc"))) +
  geom_label(aes(x = "00", y = 1.01, label = "Worse agreement of EWAC\n with reference standard"),
             hjust = "inward", vjust= -0.2, colour = "purple") +
  theme_minimal() 
```

`r fig_nums('fig_ewac_RMSD_increasedrisk_forest_plot')`


### Receiver Operating Characteristics

```{r, roc112_compute, message=F}
roc_auditc <- pROC::roc(gfmeanweekly>=14 ~ auditc, data = ats)  
roc_ewac <- pROC::roc(gfmeanweekly>=14 ~ ewac_qfv, data = ats)
roc_audit <- pROC::roc(gfmeanweekly>=14 ~ fullaudit, data = ats)

roc_results <- list()
roc_results$auditc <- as_tibble(list(
  `Index test` = "AUDIT-C score",
  AUC = as.numeric(pROC::auc(roc_auditc)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc_auditc)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc_auditc))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc_auditc, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc_auditc, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc_auditc, "b", transpose = F)$specificity
))
roc_results$audit <- as_tibble(list(
  `Index test` = "Full AUDIT score",
  AUC = as.numeric(pROC::auc(roc_audit)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc_audit)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc_audit))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc_audit, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc_audit, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc_audit, "b", transpose = F)$specificity
))
roc_results$ewac <- as_tibble(list(
  `Index test` = "EWAC",
  AUC = as.numeric(pROC::auc(roc_ewac)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc_ewac)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc_ewac))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc_ewac, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc_ewac, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc_ewac, "b", transpose = F)$specificity
))

roc_results <- bind_rows(roc_results) %>% 
  mutate(AUC = round(AUC, 3),
         `Best threshold` = round(`Best threshold`, 1),
         Sensitivity = round(Sensitivity, 3),
         Specificity = round(Specificity, 3))
roc_ewac_nominal14 <- pROC::coords(roc_ewac, 14, transpose = F)
```


```{r, roc280_compute, message=F}
roc280_auditc <- pROC::roc(gfmeanweekly>=35 ~ auditc, data = ats)  
roc280_ewac <- pROC::roc(gfmeanweekly>=35 ~ ewac_qfv, data = ats)
roc280_audit <- pROC::roc(gfmeanweekly>=35 ~ fullaudit, data = ats)


roc280_results <- list()
roc280_results$auditc <- as_tibble(list(
  `Index test` = "AUDIT-C score",
  AUC = as.numeric(pROC::auc(roc280_auditc)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc280_auditc)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc280_auditc))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc280_auditc, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc280_auditc, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc280_auditc, "b", transpose = F)$specificity
))
roc280_results$audit <- as_tibble(list(
  `Index test` = "Full AUDIT score",
  AUC = as.numeric(pROC::auc(roc280_audit)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc280_audit)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc280_audit))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc280_audit, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc280_audit, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc280_audit, "b", transpose = F)$specificity
))
roc280_results$ewac <- as_tibble(list(
  `Index test` = "EWAC",
  AUC = as.numeric(pROC::auc(roc280_ewac)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc280_ewac)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc280_ewac))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc280_ewac, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc280_ewac, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc280_ewac, "b", transpose = F)$specificity
))
roc280_results <- bind_rows(roc280_results) %>% 
  mutate(AUC = round(AUC, 3),
         `Best threshold` = round(`Best threshold`, 1),
         Sensitivity = round(Sensitivity, 3),
         Specificity = round(Specificity, 3))
roc280_ewac_nominal <- pROC::coords(roc280_ewac, 35, transpose = F)
```


The last step of this analysis was to examine the EWAC's ability to predict that participants' consumption exceeds 14 or 35 UK units/week. Receiver operating characteristics curves (available in Supplementary Material 4) are summarised with respect to the full area under the curve as well as sensitivity/specificity for the best thresholds in `r table_nums("tab_study1_roc112", display = "cite")` and `r table_nums("tab_study1_roc280", display = "cite")`.

**14 UK units/week**: EWAC increased the full area under the curve by 5 percentage points compared with the AUDIT-C score (`r pvrounding(roc.test(roc_auditc, roc_ewac, method = "delong")$p.value)`) and by 7 percentage points compared with the full AUDIT score (`r pvrounding(roc.test(roc_audit, roc_ewac, method = "delong")$p.value)`), 
The cut-off maximising the sum of specificity and sensitivity on the EWAC is 10 units/week. The sensitivity at this threshold is identical to AUDIT-C, but specificity is increased by 13 percentage points. Using the nominal cut-off of 14 units/week on the EWAC increases specificity to `r round(roc_ewac_nominal14$specificity, 3)`, at the cost of a smaller sensitivity of `r round(roc_ewac_nominal14$sensitivity, 3)`.

`r table_nums('tab_study1_roc112')`

```{r tab_roc112}
roc_results %>% kable
```


**35 UK units/week**: EWAC provides a small increase in the full area under compared with the AUDIT-C score (`r pvrounding(roc.test(roc280_auditc, roc280_ewac, method = "delong")$p.value)`) and the full AUDIT score (`r pvrounding(roc.test(roc280_audit, roc280_ewac, method = "delong")$p.value)`).


`r table_nums('tab_study1_roc280')`

```{r tab_roc280}
roc280_results %>% kable
```

*Note*: The best threshold refers the cut-off value that maximises the sum of sensitivity and specificity.


## Study 2: Concurrent validity in hospital patients

```{r tlfb_results_computation}
tlfb_measured <- tdata_b %>% 
  group_by(pid) %>% 
  mutate(num_days = sum(!is.na(alcunits))) %>% 
  ungroup() %>% 
  filter(!is.na(alcunits) & !is.na(ewac_stan) & num_days >= 7) %>% 
  group_by(pid, ewac_stan, q_admin_mode) %>% 
  summarise(tlfb_units = mean(alcunits, na.rm = T)*7)
  
tlfb_descriptives <- list(
  MD = mean(tlfb_measured$ewac_stan - tlfb_measured$tlfb_units),
  MD.ME = 1.96 * sqrt( var(tlfb_measured$ewac_stan - tlfb_measured$tlfb_units) /
      (nrow(tlfb_measured) - 1) ),
  MD.p = t.test(tlfb_measured$ewac_stan - tlfb_measured$tlfb_units)$p.value,
  RMSD = sqrt(mean((tlfb_measured$ewac_stan - tlfb_measured$tlfb_units)^2, na.rm = T)),
  MSD = mean((tlfb_measured$ewac_stan - tlfb_measured$tlfb_units)^2, na.rm = T),
  MSD.ME = 1.96 * sqrt(var((tlfb_measured$ewac_stan - tlfb_measured$tlfb_units)^2) / 
                         (nrow(tlfb_measured) - 1)),
  RMSD.p = chisq.test.variance( (tlfb_measured$ewac_stan - tlfb_measured$tlfb_units)^2,
                                sigma = 4)$p.value
)  
```  

A total of `r sum(qdata$auditc_risk == "Low")` participants (`r round(mean(qdata$auditc_risk == "Low")*100)`%) met the definition of low-risk alcohol consumption (AUDIT-C score below 5), `r sum(qdata$auditc_risk == "Increasing")` participants (`r round(mean(qdata$auditc_risk == "Increasing")*100)`%) increasing-risk alcohol consumption (AUDIT-C score 5 to 7), and `r sum(qdata$auditc_risk == "High")` participants (`r round(mean(qdata$auditc_risk == "High")*100)`%) high-risk alcohol consumption (AUDIT-C score 8 or more).

MD was estimated at `r tbrounding(tlfb_descriptives$MD)` unit/week [95%CI: `r round(tlfb_descriptives$MD - tlfb_descriptives$MD.ME, 1)`, `r round(tlfb_descriptives$MD + tlfb_descriptives$MD.ME, 1)`], which does not provide any evidence of bias greater than 1 unit/week (`r pvrounding(tlfb_descriptives$MD.p)`). As for error, RMSD was estimated at `r tbrounding(tlfb_descriptives$RMSD)` [95%CI: `r tbrounding(sqrt(tlfb_descriptives$MSD - tlfb_descriptives$MSD.ME))`, `r tbrounding(sqrt(tlfb_descriptives$MSD + tlfb_descriptives$MSD.ME))`] and was statistically significantly greater than 2 units (`r pvrounding(tlfb_descriptives$RMSD.p)`). A potential reason for RMSD being considerably smaller than in Study 1 is the distribution of alcohol consumption of this small pilot dataset. Respondents' alcohol intake as estimated by TLFB was low, with a mean of 7 units/week; a median of 2 units/week, and a 90th percentile of 23 units/week. Consequently, the probability of observing the strong deviations that can be observed in presence of high alcohol consumption data was low.

We investigated whether the mode of administration of the Extended AUDIT-C had an effect. In the self-administered group, MD = `r tbrounding(with(filter(tlfb_measured, q_admin_mode == "Self"), mean(ewac_stan-tlfb_units)))`, compared with MD = `r tbrounding(with(filter(tlfb_measured, q_admin_mode == "Researcher"), mean(ewac_stan-tlfb_units)))`. This suggests, at the first look, that EWAC was `r tbrounding(coef(lm(ewac_stan-tlfb_units~relevel(factor(q_admin_mode), ref="Self"), data = tlfb_measured))[2])` units greater 
[`r paste(tbrounding(confint(lm(ewac_stan-tlfb_units~relevel(factor(q_admin_mode), ref="Self"), data = tlfb_measured))[2,]), collapse = ";")`] when the Extended AUDIT-C is administered by a researcher, but this difference is not statistically significant (`r pvrounding(t.test(ewac_stan-tlfb_units ~ q_admin_mode, data = tlfb_measured)$p.value)`). A larger sample size would be required to address this question with greater precision.

```{r tlfb_scatterplot, warning=F, message = F, fig.height=5, fig.width=7}

ggplot(tlfb_measured, aes(y = ewac_stan, x = tlfb_units)) +
  geom_point(aes(shape = q_admin_mode)) +
  geom_abline(aes(intercept = 0, slope = 1, col = "Identity", linetype = "Identity")) +
  geom_smooth(aes(col="OLS", linetype = "OLS"), method ='lm', formula=y~x) +
  geom_smooth(aes(col="Spline", linetype = "Spline"), 
              method = 'auto') +
  scale_colour_manual(name="Line of fit",
    values = c("Identity" = "black", "OLS" = "blue", "Spline" = "red")) +
  scale_linetype_manual(name="Line of fit",
    values = c("Identity" = "solid", "OLS" = "longdash", "Spline" = "dotted")) +
  scale_shape_manual(name = "AUDIT administration mode",
                       values = c("Self" = 3, 
                                  "Researcher" = 1)) +
  theme_bw() +
  ylab("EWAC (UK units/week)") +
  xlab("Crude TLFB sample mean (UK units/week)")+
  coord_equal() +
  scale_x_continuous(breaks = seq(0, 100, 2), limits = c(0, 44), minor_breaks = F) +
  scale_y_continuous(breaks = seq(0, 100, 2), limits = c(0, 44), minor_breaks = F) +
  geom_hline(yintercept = 14, color = "grey50") + 
  geom_vline(xintercept = 14, color = "grey50")

```

`r fig_nums('fig_scatter_tlfb')`


## Study 3: Empirical distribution functions
```{r exclude_under18}
# From this point onwards, only drinkers aged 18 years and over
hse_dk18 <- filter(hse, age >= 18 & dnnow == 1) # only those drinking 'at all these days'
ats_dk18 <- filter(ats, actage >= 18 & audit1 > 1) %>%  # not 'never' drinkers
  mutate(agg_qfv = ewac_qfv)
```


`r table_nums("tab_aggregate_summary_stats", display = "cite")` provides estimates of total alcohol consumption in adults residing in private households in England using four different estimators, and compares them with alcohol retail sales. The HSE schedules provide the highest estimates of alcohol consumption and coverage of sale statistics. The EWAC estimates of total consumption are just `r trunc((sum(ats_dk18$agg_qfv * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T))/(sum(hse_dk18$weektot * hse_dk18$wt_drink, na.rm =T)/sum(hse_dk18$wt_drink, na.rm =T))*100)`% of the HSE prospective diary, considered a very reliable estimate.

`r table_nums('tab_aggregate_summary_stats')`

| Study     | Mean (units/week)     | Median | Variance | N | % of alcohol sold |
| ----------| ---------------------:| --------:|--------:| ----: | -----:
| HSE beverage-specific QF      | `r tbrounding(sum(hse_dk18$totalwu * hse_dk18$wt_int, na.rm =T)/sum(hse_dk18$wt_int, na.rm =T))`  |   `r tbrounding(median(hse_dk18$totalwu, na.rm =T))`  | `r tbrounding(var(hse_dk18$totalwu, na.rm =T))` |  `r formatbm(sum(!is.na(hse_dk18$totalwu)))` | `r tbrounding(sum(hse_dk18$totalwu * hse_dk18$wt_int, na.rm =T)/sum(hse_dk18$wt_int, na.rm =T)*100 / alcohol_pcapita_drinker_2014_units)` |
| HSE prospective diary | `r tbrounding(sum(hse_dk18$weektot * hse_dk18$wt_drink, na.rm =T)/sum(hse_dk18$wt_drink, na.rm =T))`   | `r tbrounding(median(hse_dk18$weektot, na.rm =T))`     | `r tbrounding(var(hse_dk18$weektot, na.rm =T))` |  `r formatbm(sum(!is.na(hse_dk18$weektot)))` |`r tbrounding(sum(hse_dk18$weektot * hse_dk18$wt_drink, na.rm =T)/sum(hse_dk18$wt_drink, na.rm =T)*100/alcohol_pcapita_drinker_2014_units)` |
| ATS GF    | `r tbrounding(sum(ats_dk18$gfmeanweekly * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T))`   | `r tbrounding(median(ats_dk18$gfmeanweekly, na.rm =T))`   | `r tbrounding(var(ats_dk18$gfmeanweekly, na.rm =T))` |  `r formatbm(sum(!is.na(ats_dk18$gfmeanweekly)))` |`r tbrounding(sum(ats_dk18$gfmeanweekly * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T)*100/alcohol_pcapita_drinker_2014_units)` |
| ATS EWAC    | `r tbrounding(sum(ats_dk18$agg_qfv * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T))`   | `r tbrounding(median(ats_dk18$agg_qfv, na.rm =T))`   | `r tbrounding(var(ats_dk18$agg_qfv, na.rm =T))` |  `r formatbm(sum(!is.na(ats_dk18$agg_qfv)))` |`r tbrounding(sum(ats_dk18$agg_qfv * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T)*100/alcohol_pcapita_drinker_2014_units)` |
| Retail sales | `r tbrounding(alcohol_pcapita_drinker_2014_units)` | -- | -- | -- | -- |

`r fig_nums('fig_ECDF', display = "cite")` suggests that the EWAC, like the ATS GF, estimates a higher prevalence of low risk consumption ($\leq$ 14 units/week) and increased risk consumption than HSE. In contrast very high alcohol consumption ($\geq$ 50 units/week) is higher in HSE. This may be due to a combination of difference in sampling coverage, nonresponse bias, or measurement error in the alcohol schedules.

```{r ggplot_ECDF, warning=F, message=F, fig.height=5, fig.width=7}
ggplot() + 
  scale_y_continuous(breaks = seq(0, 1, .1)) +
  scale_x_continuous(limits = c(0, 100),
                     breaks = seq(0, 500, 10),
                     minor_breaks = seq(0, 500, 5)) +
  stat_ecdf(aes(gfmeanweekly, colour = "ATS GF", linetype = "ATS GF"), 
            data = ats_dk18, weight = ats_dk18$weighttns13, na.rm =T, lwd=.7) +
  stat_ecdf(aes(agg_qfv, colour = "ATS EWAC", linetype = "ATS EWAC"),
            data = ats_dk18,  weight = ats_dk18$weighttns13, geom = "step", lwd = .7) +
  stat_ecdf(aes(totalwu, colour = "HSE QF", linetype = "HSE QF"),
            data = hse_dk18, weight = hse_dk18$wt_int, geom = "step", lwd = .7) +
  stat_ecdf(aes(weektot, colour = "HSE Diary", linetype = "HSE Diary"),
            data = hse_dk18, weight = hse_dk18$wt_drink, lwd = .3) +
  ylab("Empirical cumulative density") + xlab("Average units/week")+
  geom_vline(xintercept = 14) + 
  annotate(geom = "text", x = 16.5, y = .15, label = "14 units/week", angle = 90) +
  theme_bw() +
  scale_colour_manual(
    name = "Estimator",
    values = c("ATS GF" = "black",
               "ATS EWAC" = "darkorange",
               "HSE QF" = "darkorchid3",
               "HSE Diary" = "darkorchid3")) + 
  scale_linetype_manual(
    name = "Estimator",
    values = c(1, 1, 2, 1))
```

`r fig_nums('fig_ECDF')`



# Discussion

## Main findings

This paper examined the predictive capabilities of the Extended AUDIT-C in assessing alcohol consumption in two English populations: community dwelling household residents, and hospital clinic outpatients. The Extended AUDIT-C is a variant of the AUDIT-C containing a choice of 6 response items to quantify drinking frequency, and 7 response items to quantify the average quantity consumed on any drinking day. The resulting EWAC estimates usual alcohol consumption with a mean precision of $\pm$ 11 units/week when compared to the GF alcohol schedule, or $\pm$ 5 units/week when compared to a 28-day TLFB in a sample of lower-risk alcohol drinkers. Although bias is mostly consistent across subgroups examined (age/sex, education, smoking status, religion), there is strong evidence that EWAC overestimates alcohol consumption by 2-3 units/week in Black and Other ethnic groups. At the same time, average precision is better in Black, Asian and Other ethnic groups. This is likely due to a lower mean alcohol consumption than White British and Mixed ethnic groups. We also noted a weaker precision for both current and ex-smokers. Using TLFB as a reference standard, similar results are found in a clinical population (Study 2), with no strong evidence that the EWAC is less valid when the Extended AUDIT-C is self-administered than when administered by a researcher.


## Strengths and limitations 

To the best of our knowledge, this paper is the first to (a) develop an EWAC using a well-accepted and validated alcohol screening tool such as the AUDIT; and (b) quantify its bias and precision with respect to a continuous measure of alcohol consumption. One US study [@Rubinsky2013] previously reported mean consumption by AUDIT-C score, yet without quantifying bias or precision of such a measure. Other studies have studied the AUDIT-C's potential in estimating alcohol consumption, but only in relation to predicting consumption in excess of a predefined threshold [@DeMeneses-Gaya2009]. Such studies achieved AUCs ranging 0.83-0.96. In Study 1, we demonstrated the EWAC's superiority for predicting GF $\geq$ 14 units/week. While its AUC of 0.921 [95% CI: 0.917; 0.925] is comparable with many other studies, the specificity gain from 0.684 to 0.876 places the EWAC with the other best-performing alcohol consumption estimators.

This study provides strong confidence in the internal and external validity of findings in England on account of the large sample size of the ATS, the range of subgroup analyses reported, and replication of the analysis in a clinical population using a second reference standard, the TLFB (Study 2).

We note some limitations. 

Findings reported in this paper may not apply to other countries, or to small subpopulations with an atypical alcohol consumption, such as patients seeking care for conditions such as addiction or alcohol-related liver disease. The quality of alcohol survey data may also impact on the internal validity of Study 1. 

The selected reference standard has a strong influence on estimates of precision (RMSD). The reference standard's own error will inflate the RMSD if it does not correlate with the EWAC's error. This means some of the RMSD is likely to be attributable to error in the reference standard rather than the EWAC. For example, a US telephone interview study on 119 participants [@Greenfield2009] measured a Pearson’s correlation coefficient of $r$ = 0.86 and 0.87 between drinking frequencies and volumes measured by a GF interview and a subsequent 28 day prospective diary. A Kendall's rank correlation $\tau$ = 0.41 between GF and a 7-day prospective diary was found in a telephone interview study of 773 participants across Switzerland [@Heeb2005]. For reference, our study measured a correlation coefficient $r$ = 0.71 and $\tau$ = 0.63 between EWAC and GF, that is, a similar level of agreement as GF with TLFB. Since both reference standards employed in studies 1 and 2 can be safely assumed to be affected by substantial error of their own, our measures of RMSD can be regarded as very conservative estimators of precision. This means precision is likely to be better in reality than reported by studies 1 and 2.

Despite its large sample size, the ATS exhibits limitations of its own. Like the HSE, ATS does not cover populations excluded from most sampling frames, such as residents of communal and carceral institutions, homeless people, or migrant populations. Independent of coverage, evidence suggests that survey nonrespondents may have higher levels of alcohol consumption and harm [@Gorman2014; @Christensen2015; @Boniface2017]. Furthermore, the ATS potentially misses some (mostly low-risk) drinkers, even among respondents: the proportion of respondents classified as non-drinkers (based on AUDIT item 1) in ATS is 10% higher than in HSE data, in which respondents are asked to confirm whether they never drink alcohol, or only drink 'very occasionally' [@DeVocht2016]. All these factors are likely to affect MD and RMSD estimates reported in Study 1, and explain some of the discrepancy with Study 3 findings. 

<!-- During data collection, we recorded a frequent confusion with the AUDIT's item 1: some participants being confused as to whether the question refers to number of days in which alcohol has been consumed, or number of occasions on any given day. We believe this to be a common occurrence when the AUDIT is self-administered. -->

## Potential applications

While retaining the AUDIT's strengths (speed, accuracy, international standardisation), the Extended AUDIT improves the granularity of the information collected on alcohol consumption, and captures greater information from higher-risk drinkers, by remediating the right-truncation of the traditional AUDIT consumption items. The EWAC enhances the Extended AUDIT's health education and promotion qualities, by translating it into a more understandable scale: alcohol consumption. This has the merit of focusing the recipient's attention to alcohol units or grams, and can facilitate uptake with brief interventions targeting skills in recognising the alcohol content of different drinks and drink sizes to reduce consumption.

This may be particularly relevant to primary and secondary prevention efforts to provide earlier interventions (identification and brief advice) to increasing-risk drinkers [@Lavoie2010]. Knowledge of alcohol beverage content is generally poor [@Mongan2015], and many countries have not adopted a measure of standard drinks [@Kalinowski2016]. In England, two thirds of drinkers could assess the standard drink equivalent in wine or beer of one alcohol unit [@ONS2009].

A more clinical approach to alcohol harm prevention would be to treat alcohol consumption like any other risk factor: blood pressure or cholesterol are frequently monitored within health systems as part of standard care and can act as a trigger for behaviour change. In a similar way, @Nutt2014 and @Rehm2016 argue that alcohol-related harm is best prevented if individuals know their consumption level, and health professionals in all settings can engage patients effectively to manage risks with evidence-based interventions.

The proposed EWAC can fulfil the same alcohol use disorder screening functions as the AUDIT-C, while at the same time providing transparent and personalised information to patients in a less stigmatising way than terminology previously in use (eg hazardous and harmful drinking): an estimate of current alcohol consumption is more accessible and understandable than an AUDIT risk score. 

This dimensional rather than categorical approach to communication an estimate of alcohol consumption may help to motivate increasing-risk drinkers to monitor and reduce their consumption, while at the same time encouraging low-risk drinkers to maintain this lifestyle. The EWAC appears particularly suitable to generate personalised feedback and monitoring as part of digital interventions.


# Declarations 

## Ethics

Study 1 and 3 were approved by the University of Southampton's Faculty of Medicine Ethics Committee (ERGO 44682). Study 2 was approved by the Health Research Authority National Research Ethics Service (IRAS 247458; REC 18/SC/0564).
 
## Consent for publication

Not applicable.

## Competing interests

None to declare.



# Supplementary materials

## Supplementary materials 1: EWAC coefficients (CSV file)

## Supplementary materials 2: Bayesian model report (PDF file)

## Supplementary materials 3: Subgroup analyses


`r table_nums('tab_ewac_validity_reg')`

```{r, results='asis'}
stargazer::stargazer(#lm_bias_mp, lm_rmsd_mp, 
          lm_bias_stan, lm_rmsd_stan, 
          type = ifelse(knit_output_pdf, "latex", "html"),
          ci = rep(T, 2),
          digits = 1, digits.extra	= 1, initial.zero = T, style = "ajs",
          single.row = T, intercept.bottom = F, align=TRUE, no.space= T,
          report = "vcs*")

```

```{r export_CSV_coefficients}
results_lm_all_MD <- data.frame(summary(lm_bias_stan)$coefficients)
results_lm_all_MD$Variable <- row.names(results_lm_all_MD)
results_lm_all_MD <- results_lm_all_MD %>% 
  transmute(Variable,
            MD_coef = Estimate,
            MD_LB = Estimate - 1.96 * `Std..Error`,
            MD_UB = Estimate + 1.96 * `Std..Error`,
            MD_SE = `Std..Error`,
            MD_pvalue = `Pr...t..`)

results_lm_all_MSD <- data.frame(summary(lm_rmsd_stan)$coefficients)
results_lm_all_MSD$Variable <- row.names(results_lm_all_MSD)
results_lm_all_MSD <- results_lm_all_MSD %>% 
  transmute(Variable,
            log_MSD_coef = Estimate,
            log_MSD_SE = `Std..Error`,
            log_MSD_pvalue = `Pr...t..`,
            Relative_RMSD = sqrt(exp(Estimate)),
            Relative_RMSD_LB = sqrt(exp(Estimate - 1.96 * `Std..Error`)),
            Relative_RMSD_UB = sqrt(exp(Estimate + 1.96 * `Std..Error`))
            )

results_lm_increasing_MD <- data.frame(summary(lm_bias_increasingrisk)$coefficients)
results_lm_increasing_MD$Variable <- row.names(results_lm_increasing_MD)
results_lm_increasing_MD <- results_lm_increasing_MD %>% 
  transmute(Variable,
            MD_coef = Estimate,
            MD_LB = Estimate - 1.96 * `Std..Error`,
            MD_UB = Estimate + 1.96 * `Std..Error`,
            MD_SE = `Std..Error`,
            MD_pvalue = `Pr...t..`)

results_lm_increasing_MSD <- data.frame(summary(lm_rmsd_increasingrisk)$coefficients)
results_lm_increasing_MSD$Variable <- row.names(results_lm_increasing_MSD)
results_lm_increasing_MSD <- results_lm_increasing_MSD %>% 
  transmute(Variable,
            log_MSD_coef = Estimate,
            log_MSD_SE = `Std..Error`,
            log_MSD_pvalue = `Pr...t..`,
            Relative_RMSD = sqrt(exp(Estimate)),
            Relative_RMSD_LB = sqrt(exp(Estimate - 1.96 * `Std..Error`)),
            Relative_RMSD_UB = sqrt(exp(Estimate + 1.96 * `Std..Error`))
            )

for (i in list("results_lm_all_MD", "results_lm_all_MSD", 
         "results_lm_increasing_MD", "results_lm_increasing_MSD")) {
  write.csv(get(i), file = paste0("../04_suppmat/", i, ".csv"), row.names = F)
}

```

`r table_nums('tab_ewac_validity_reg_increasedrisk')`

```{r, results='asis'}
stargazer::stargazer(#lm_bias_mp, lm_rmsd_mp, 
          lm_bias_increasingrisk, lm_bias_increasingrisk, 
          type = ifelse(knit_output_pdf, "latex", "html"),
          ci = rep(T, 2),
          digits = 1, digits.extra	= 1, initial.zero = T, style = "ajs",
          single.row = T, intercept.bottom = F, align=TRUE, no.space= T,
          report = "vcs*")

```
## Supplementary materials 4: Receiver operating characteristics curves curves

```{r roc_curves_112, fig.height=5, fig.width=7}
# roc_auditc$linetype <- "solid"
# roc_auditc$colour <- "#70ee9c"
# roc_ewac$linetype <- "longdash"
# roc_ewac$colour <- "#434371"



thresholds_auditc <- pROC::coords(roc_auditc, x = seq(3.5, 6.5, 1), 
                          input = "threshold", transpose = F)
thresholds_auditc$name <- "AUDIT-C score"
thresholds_auditc$`Cut-off` <- if_else(thresholds_auditc$threshold == 4.5, 
                                  "Max sens. & spec.", "Other")

thresholds_ewac <- pROC::coords(roc_ewac, x = c(8, 10, 12), 
                          input = "threshold", transpose = F) 
thresholds_ewac$name <- "EWAC"
thresholds_ewac$`Cut-off` <- if_else(thresholds_ewac$threshold == 10, 
                                  "Max sens. & spec.", "Other")

thresholds_audit <- pROC::coords(roc_audit, x = seq(4.5, 6.5, 1), 
                          input = "threshold", transpose = F) 
thresholds_audit$name <- "Full AUDIT score"
thresholds_audit$`Cut-off` <- if_else(thresholds_audit$threshold == 5.5, 
                                  "Max sens. & spec.", "Other")

ggroc(list("EWAC" = roc_ewac,
           "AUDIT-C score" = roc_auditc, 
           "Full AUDIT score" = roc_audit), 
      aes=c("linetype", "colour")) + 
  geom_point(mapping = aes(x = specificity, y = sensitivity, shape = `Cut-off`),
             data = bind_rows(thresholds_ewac, thresholds_auditc, thresholds_audit),
             size = 2.5, stroke = 1.2, col = "black") +
  geom_text(data = bind_rows(thresholds_ewac, thresholds_auditc, thresholds_audit),
            aes(x = specificity, y = sensitivity, label = threshold),
            hjust= -0.2, vjust = -0.2) +
  scale_shape_manual(values = c(4, 1, 3) ) +
  ggtitle("Consumption >= 112g/week")

write.csv(pROC::coords(roc_auditc, transpose = F),
          file = "ROC/roc_112g_auditc.csv", row.names = F)
write.csv(pROC::coords(roc_audit, transpose = F),
          file = "ROC/roc_112g_full_audit.csv", row.names = F)
write.csv(pROC::coords(roc_ewac, transpose = F),
          file = "ROC/roc_112g_ewac.csv", row.names = F)


```


```{r roc_curves_280, fig.height=5, fig.width=7}
# roc_auditc$linetype <- "solid"
# roc_auditc$colour <- "#70ee9c"
# roc_ewac$linetype <- "longdash"
# roc_ewac$colour <- "#434371"

thresholds280_auditc <- pROC::coords(roc280_auditc, x = seq(5.5, 7.5, 1), 
                          input = "threshold", transpose = F)
thresholds280_auditc$name <- "AUDIT-C score"
thresholds280_auditc$`Cut-off` <- if_else(thresholds280_auditc$threshold == 6.5, 
                                  "Max sens. & spec.", "Other")

thresholds280_ewac <- pROC::coords(roc280_ewac, x = c(14, 17, 19), 
                          input = "threshold", transpose = F) 
thresholds280_ewac$name <- "EWAC"
thresholds280_ewac$`Cut-off` <- if_else(thresholds280_ewac$threshold == 17, 
                                  "Max sens. & spec.", "Other")

thresholds280_audit <- pROC::coords(roc280_audit, x = seq(5.5, 7.5, 1), 
                          input = "threshold", transpose = F) 
thresholds280_audit$name <- "Full AUDIT score"
thresholds280_audit$`Cut-off` <- if_else(thresholds280_audit$threshold == 6.5, 
                                  "Max sens. & spec.", "Other")

ggroc(list("EWAC" = roc280_ewac,
           "AUDIT-C score" = roc280_auditc, 
           "Full AUDIT score" = roc280_audit), 
      aes=c("linetype", "colour")) + 
  geom_point(mapping = aes(x = specificity, y = sensitivity, shape = `Cut-off`),
             data = bind_rows(thresholds280_ewac, thresholds280_auditc, thresholds280_audit),
             size = 2.5, stroke = 1.2, col = "black") +
  geom_text(data = bind_rows(thresholds280_ewac, thresholds280_auditc, thresholds280_audit),
            aes(x = specificity, y = sensitivity, label = threshold),
            hjust= -0.5, vjust = 0.4) +
  scale_shape_manual(values = c(4, 1, 3) ) +
  ggtitle("Consumption >= 280g/week") +
  coord_cartesian(xlim = c(1, .5), ylim = c(.5, 1))

write.csv(pROC::coords(roc280_auditc, transpose = F),
          file = "ROC/roc_280g_auditc.csv", row.names = F)
write.csv(pROC::coords(roc280_audit, transpose = F),
          file = "ROC/roc_280g_full_audit.csv", row.names = F)
write.csv(pROC::coords(roc280_ewac, transpose = F),
          file = "ROC/roc_280g_ewac.csv", row.names = F)

```

# Tables


Table 1:  <a name="table_questionnaires"></a>Overview of alcohol schedule used in this paper.

<table style="width:100%;">
<colgroup>
<col width="20%">
<col width="80%">
</colgroup>
<thead>
<tr class="header">
<th>Survey module</th>
<th>Schedule</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>ATS QF module</em></td>
<td><ul>
<li>On how many days, if any, did you personally drink a drink containing alcohol in the last four weeks?</li>
<li>What was the maximum number of units you personally consumed on any one day when drinking an alcoholic drink or drinks in the last four weeks?</li>
<li>On how many days, if any, in the last four weeks did you personally drink… [prompting in turn &#39;51-60 units?&#39;, &#39;41-50 units?&#39;, …, &#39;1-2 units?</li>
</ul>
</tr>
<tr class="even">
<td align="center"><em>Health Survey for England</em></td>
<td><ul>
<li>Thinking now about all kinds of drinks, how often have you had an alcoholic drink of any kind during the last 12 months? <em>[8 items from &#39;Almost every day&#39; to &#39;Not at all in the last 12 months&#39;]</em></li>
<li>Did you have an alcoholic drink in the seven days ending yesterday?</li>
<li>On how many days out of the last seven did you have an alcoholic drink?</li>
<li>Which day last week did you last have an alcoholic drink/have the most to drink?</li>
<li>Thinking about last [answer to previous question], what types of drink did you have that day? [list of 8 types of alcohol beverages]</li>
<li>[running through each type of beverage and recording number of units drunk]</li>
</ul></td>

</tr>
</tbody>
</table>


# References