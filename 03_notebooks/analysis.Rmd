---
title: Concurrent validity of an Estimator of Weekly Alcohol Consumption (EWAC) based
  on the Extended AUDIT
bibliography: bibliography.bib
csl: elsevier-vancouver.csl
output:
  word_document:
    reference_docx: template.docx
  html_document:
    df_print: paged
    toc: yes
link-citations: yes
always_allow_html: yes
---


```{r loading data, include=F}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)

# Loading data
source("../01_src/functions.R")
# source("../01_src/filepaths.R")
source("../01_src/audit_weights.R")


knit_output_pdf <- F
if(knit_output_pdf){
  options(knitr.table.format = "pdf")
} else {
  options(knitr.table.format = "pandoc")
}


library(tidyverse)
library(knitr)
library(captioner)
library(kableExtra)
library(pROC)
library(MASS)
# library("scales")
# library("xtable")
library(stargazer)
library(spatstat)
library(ggplot2)
source("../01_src/stat_ecdf_weighted.R")

auditx_labels <- c("audit1_label", "audit2_label", "audit3_label")

load(file.path("..", "02_data", "HSE.rda"))
load(file.path("..", "02_data", "ATS.rda"))
load(file.path("..", "02_data", "ATS_training_sample_30pct.rda"))

ats <- ats %>% 
  mutate(
    # Too small a sample size too manage
    sex = if_else(sex == "In another way", NA_character_, as.character(sex)),
    p_id = 1:n(), 
    audit1_label = if_else(.$audit1_label %in% c("Refused", "Don't know"), 
                           NA_character_, audit1_label),
    audit2_label = if_else(.$audit2_label %in% c("Refused", "Don't know"), 
                           NA_character_, audit2_label),
    audit3_label = if_else(.$audit3_label %in% c("Refused", "Don't know"), 
                           NA_character_, audit3_label)
  ) %>% 
  mutate(sex = factor(sex, levels = c("Women", "Men")))

# Sample sizes
n_ats <- nrow(ats)
n_ats_audit1never <- nrow(filter(ats, audit1 == 1))
n_ats_auditmissing <- nrow(filter(ats,
                                  audit1 != 1 &
                                  (is.na(audit1_label) | 
                                    is.na(audit2_label) | 
                                    is.na(audit3_label))))
n_ats_validaudit <- nrow(filter(ats,
                                audit1 != 1 &
                                  !is.na(audit1_label) & 
                                    !is.na(audit2_label) & 
                                    !is.na(audit3_label)))
valid_n_study1a <-  nrow(na.omit(ats[, c("gfmeanweekly", "audit1_label", "audit2_label", "audit3_label")]))
valid_n_study1a_training <-  nrow(na.omit(ats[ats$p_id %in% ats_sampling$p_id, c("gfmeanweekly", "audit1_label", "audit2_label", "audit3_label")]))
valid_n_study1a_validation <-  nrow(na.omit(ats[!ats$p_id %in% ats_sampling$p_id, c("gfmeanweekly", "audit1_label", "audit2_label", "audit3_label")]))

valid_n_study1b <-  nrow(na.omit(
  dplyr::select(filter(ats, !p_id %in% ats_sampling$p_id),
                audit1_label, audit2_label, audit3_label, gfmeanweekly,
                sex, ageg7, ethgrp, religion, highqual, smokstat)
))
valid_n_study1c <- nrow(na.omit(
  dplyr::select(filter(ats, !p_id %in% ats_sampling$p_id & 
                         (auditc >= 5 | fullaudit >=8)), 
                audit1_label, audit2_label, audit3_label, gfmeanweekly,
                sex, ageg7, ethgrp, favdrink, tryalclyc2, 
                religion, highqual, smokstat)))

# Removing ML training data
ats_complete_data <- ats
ats <- ats %>%
  filter(!p_id %in% ats_sampling$p_id)

# Alcohol retail data from PHE 2017
alcohol_sales_2014_liters <- 361429387
alcohol_pcapita_adults_2014_units <-  16.3 # per capita for all population
alcohol_pcapita_drinker_2014_units <- 19.3 # per capita for drinkers only
MYPE_2014 <- 42724917 # population aged 18+

# Captions
table_nums <- captioner::captioner(prefix = "Table")
tab_audit_tools_overview <- table_nums(
  name = "tab_audit_tools_comparison",
  caption = "Comparison of AUDIT-C and Extended AUDIT-C (questions 1 and 2)")
tab_ats_rmsd_quantiles <- table_nums(
  name = "tab_ats_rmsd_quantiles",
  caption = paste0("Percentiles of the absolute deviation between EWAC and GF schedule (n = ", formatbm(valid_n_study1a_validation), ")"))
tab_study1_roc112 <- table_nums(
  name = "tab_study1_roc112",
  caption = paste0("Receiver operating characteristics of AUDIT-C score and EWAC for consumption >= 14 UK units or 112g/week (n = ", formatbm(valid_n_study1a_validation), ")"))
tab_study1_roc280 <- table_nums(
  name = "tab_study1_roc280",
  caption = paste0("Receiver operating characteristics of AUDIT-C score and EWAC for consumption >= 35 UK units or 280g/week (n = ", formatbm(valid_n_study1a_validation), ")"))
tab_aggregate_summary_stats <- table_nums(
  name = "tab_aggregate_summary_stats",
  caption = "Summary statistics on alcohol consumption in England in residents aged 18 years and over (excluding abstainers)")


fig_nums <- captioner(prefix = "Figure")
fig_scatter_ats <- fig_nums(
  name = 'fig_scatter_ats',
  caption = 'Plots of EWAC against GF in (a) low/increasing risk respondents (n=15,008) and (b) all respondents (n=15,731)')
fig_ECDF<- fig_nums(
  name = 'fig_ECDF',
  caption = 'Empirical cumulative distribution function of weekly alcohol consumption in England according to four alcohol schedules in residents aged 18 years and over')


```


# Abstract

**Background and Aims:** The 3-question Alcohol Use Disorders Identification Test (AUDIT-C) is frequently used in healthcare for screening and brief advice about levels of alcohol consumption. AUDIT-C scores (0–12) provide feedback as categories of risk rather than estimates of actual alcohol intake, an important variable for behaviour change. The study aimed to (a) develop a continuous metric from the Extended AUDIT-C expressed in UK units (8g pure ethanol), offering equivalent accuracy, and providing a direct estimator of weekly alcohol consumption (EWAC); (b) evaluate the EWAC’s bias and error using the Graduated-Frequency (GF) questionnaire as a reference standard of alcohol consumption.

**Design:** Cross-sectional diagnostic study based on a nationally-representative survey.

**Settings:** Community-dwelling households in England.

**Participants:** 22,404 household residents aged $\geq$ 16 years reporting drinking alcohol at least occasionally.

**Measurements:** Computer-assisted personal interviews consisting of (a) AUDIT questionnaire with extended response items (the 'Extended AUDIT') and (b) GF. Primary outcomes were: mean deviation <1 UK unit (metric of bias); root mean squared deviation <2 UK units (metric of total error) between EWAC and GF. The secondary outcome was the receiver operating characteristic area under the curve for predicting alcohol consumption in excess of 14 and 35 UK units.

**Findings:** EWAC had a positive bias of 0.2 UK units [95% confidence interval: 0.08, 0.4] compared to GF. Deviations were skewed: while the mean error was ±11 UK units/week [9.5, 11.9], in half of participants the deviation between EWAC and GF was between 0 and ±2.1 UK units/week. EWAC predicted consumption in excess of 14 UK units/week with a significantly greater area under the curve (0.918 [0.914, 0.923]) than AUDIT-C (0.870 [0.864, 0.876]) or the full AUDIT (0.854 [0.847, 0.860]).

**Conclusions:** The EWAC <https://ewac.netlify.app> is designed to estimate weekly alcohol consumption using answers to the Extended AUDIT-C. The EWAC meets the targeted bias tolerance. It is superior in accuracy to AUDIT-C and the full AUDIT when predicting consumption thresholds, making it a reliable complement to the Extended AUDIT-C for health promotion interventions.

# Keywords

alcohol consumption; self report; alcohol use disorder; screening programs, diagnostic; preventive health services

# Introduction

Alcohol consumption is responsible for 5% of disability-adjusted life years [@Shield2020]. This burden extends far beyond the health burden of *alcohol use disorders*, as defined in the International Statistical Classification of Diseases (ICD-10 F10.1/F10.2 [@ICD10]) or the Diagnostic and Statistical Manual of Mental Disorders [@DSM5]. Clinical guidelines aiming to prevent [@NICE-PH24], treat and reduce [@NICE-CG115] harm from alcohol consumption recommend systematic screening for alcohol consumption using validated clinical tools. However, conceptual differences (exemplified by the diagnostic classifications above) remain in how best to diagnose, measure, and communicate harm [@Saunders2019].

A global standard has emerged in the 10-item Alcohol Use Disorders Identification Test (AUDIT) [@Babor2001]. The shorter 3-item AUDIT-C focusses on consumption, and has equivalent predictive capability [@Bush1998]. AUDIT-C is easy to use, making it an attractive choice for alcohol screening and brief interventions in healthcare @Kaner2018 and other settings @Kaner2017. AUDIT-C exhibits two characteristics:

1. **Ceiling effect:** AUDIT-C's maximum response options for alcohol consumption frequency and quantity are heavily right-censored (`r table_nums("tab_audit_tools_comparison", display = "cite")`). This creates a ceiling effect making the AUDIT-C poorly responsive to change in individuals with a high baseline score (up to reductions of 30%; e.g. frequency of drinking down from 7 to 5 days or quantity down from 16 to 11 drinks per day).

2. **AUDIT score interpretation:** The AUDIT-C's ordinal score (range: 0–12), being an indirect measure of risk, is less easily interpretable to patients and clinicians alike, and risk categories informed by diagnostic accuracy studies [@DeMeneses-Gaya2009] vary across countries [@Nadkarni2019]. Evidence suggests this poses challenges in the delivery of brief interventions. Healthcare professionals lack confidence in discussing alcohol consumption [@Beich2002; @Johnson2010; @Hutchings2006; @McCormick2006]. The abstract AUDIT-C score requires training on how to deliver feedback [@Beich2002; @Johnson2010]. The public understanding of 'alcohol risk' is variable and not always related to the amount consumed [@ODonnell2020]. Similar challenges are faced when communicating AUDIT-C results in self-administered interventions such as web apps [@Beyer2018].

The ‘Extended AUDIT-C’ addresses the first characteristic thanks to a greater range of response options on quantity and frequency (`r table_nums("tab_audit_tools_comparison", display = "cite")`). It has been used in UK research as part of two trials [@Kaner2013c; @Crane2018] and one continuous household survey [@Beard2015a] to measure characteristics of consumption that could not have been measured with the right-censored AUDIT-C.

`r table_nums("tab_audit_tools_comparison")`

<<INSERT TABLE 1 HERE>>
 
The present study proposes to address the second of these characteristics. It aims to develop and validate an Estimator of Weekly Alcohol Consumption (EWAC) computed from the Extended AUDIT-C. This is a continuous metric of alcohol consumption, designed to offer equivalent diagnostic capabilities in relation to alcohol use disorders (being based on the AUDIT-C). This is intended to facilitate the delivery of screening and brief interventions by providing a more interpretable and direct measure of alcohol consumption. Measuring alcohol consumption is a crucial part of behaviour change techniques (self-monitoring, feedback on behaviour, social comparison) commonly employed in self- [@Kaner2017] and clinician-administered [@Michie2012; @Kaner2018] interventions.

# Methods

## Participants

Data originate from baseline measures in waves 110--133 (November 2015–October 2017) of the Alcohol Toolkit Study, a repeated cross-sectional survey of residents of private English households aged $\geq$ 16 years. Each month, census output areas averaging 300 households were selected by stratified random sampling. Interviewers travelled to their designated area and  approach households  quota sampling [@Beard2015a]. Respondents participated in a computer-assisted personal interview.

## Measurements

Index measurements underpinning the EWAC were the three questions making up the Extended AUDIT-C (supplementary information S2), in which participants described their drinking *during the last 6 months*.

The reference standard used is the Alcohol Toolkit Study GF schedule (supplementary information S3), in which participants described how many times they consumed given quantities of alcohol *during the last 4 weeks* [@Greenfield2000]. The GF schedule's main advantage lies in measuring occasional heavy consumption, which can constitute an important proportion of total consumption.

Other reference estimates were used, this time for aggregate comparisons. 2014 per-capita alcohol retail sales [@PHE2017] captured all alcohol produced/processed in or imported to England for sale or consumption. We also used data from 6,606 household residents aged $\geq$ 18 years participating in the 2011 Health Survey for England [@NatCenSocialResearch2013]. Year 2011 was chosen in deviation from the registered protocol [@Dutey2018]: on that particularly year, the recurring computer-assisted interviewer-led beverage-specific quantity-frequency questionnaire was accompanied by a prospective 7-day diary [@Boniface2014]. The diary reference standard was deemed more informative to an international audience, and offered a direct point of comparison with past research [@Stockwell2004; @Stockwell2014; @Stockwell2016]. 

## Estimating alcohol consumption (EWAC) 

To estimate alcohol consumption from Extended AUDIT-C responses, we employ methods developed for quantity-frequency-variability instruments [@Lemmens1992]. For every individual $i$, the EWAC is computed as the product of $F_i$ and $Q_i$ (AUDIT questions 1 and 2 respectively) adjusted with the frequency of intense drinking $V_i$ (AUDIT-3):

$$\text{EWAC}_i = F_i Q_i + V_ib$$

where $b$ denotes the average units of alcohol consumed in an intense drinking day. 

Coefficients $F, Q, V$ and $b$ are unknown. In this study, two sets of candidate coefficients are considered:

- AUDIT response item interval midpoint (e.g. 2.5 for '2 to 3 times per week')
- coefficients estimated empirically from a sample of individuals with measurements of Extended AUDIT-C and GF, using a hierarchical Bayesian response model with the estimating equation $\text{GF}_i = F_i Q_i + V_ib + e_i$, where $e$ denotes independently normally distributed errors. We set parabola-shaped informative priors on coefficients $F, Q, V$. Details on model fitting, convergence evaluation and prior tuning are reported in supplementary information S1.

## Analyses

The protocol was pre-registered [@Dutey2018]. Results are reported in UK alcohol units (8g or 10mL of pure alcohol). Analyses were conducted in `R` [@RCoreTeam2017; @package-tidyverse; @package-rstan] and all computer scripts are available online [@Dutey2020].

Participants were included in the analysis if they completed both the Extended AUDIT and the GF questionnaires. Out of `r formatbm(n_ats)` participants, `r formatbm(n_ats_audit1never)` (`r round(n_ats_audit1never/n_ats*100)`%) reported 'never' consuming alcohol in AUDIT question 1 and were not asked any further AUDIT or GF questions. A further `r formatbm(n_ats_auditmissing)` (`r round(n_ats_auditmissing/n_ats*100, 1)`%) did not have valid AUDIT-C answers. Finally, `r formatbm(n_ats_validaudit - valid_n_study1a)` participants (`r round((n_ats_validaudit - valid_n_study1a)/n_ats*100)`%) who did not have a valid GF alcohol consumption record were excluded. These GF data were assumed to be missing at random conditionally on the Extended AUDIT-C responses after a sensitivity analysis (supplementary information S1).

Valid observations (*N*=`r formatbm(valid_n_study1a)`) were separated into two datasets:

* The training dataset (*N*=`r formatbm(valid_n_study1a_training)`) consisted of a 30 percent subset of participants drawn using stratified random sampling, ensuing a balanced representation by sex, age, ethnic group and AUDIT-C risk level. It was used to estimate coefficients underpinning the EWAC (supplementary information S1). 
* The validation dataset consisted of the remaining participants (*N*=`r formatbm(valid_n_study1a_validation)`) and was used to evaluate the EWAC's bias and precision. In subgroup validation analyses utilising additional variables (eg education, smoking status), a further `r formatbm(valid_n_study1a_validation-valid_n_study1b)`/`r formatbm (valid_n_study1a_validation)` observations (`r tbrounding((valid_n_study1a_validation-valid_n_study1b)/valid_n_study1a_validation*100)`%) assumed to be missing at random were excluded.

### Overall bias and error

The agreement between the EWAC and the GF was quantified in the validation dataset:

- bias was estimated by the **mean deviation** to the reference standard $\text{MD} = n^{-1} \sum_{i=1}^{n}{(\rm{EWAC}_i - \rm{GF}_i )}$. We tested the hypothesis that the MD does not exceed 1 UK unit using a two-sided $t$-test. 
- precision was estimated by the **root mean squared deviation** $\text{RMSD} = \sqrt{n^{-1} \sum_{i=1}^{n}{( \rm{EWAC}_i - \rm{GF}_i )^2}}$, a measure of total error capturing both bias and random deviation from the reference standard. For example, an RMSD of 2 signifies that the EWAC is on average with $\pm$ 2 UK units of the reference standard. We tested the hypothesis that the RMSD does not exceed 2 UK units using a one-sided $\chi^2$ test.

Two sets of candidate coefficients were considered (see 'Design' section). We only report findings for the candidate set producing the lowest bias and error.

### Subgroup bias and error

Multivariate regression models tested whether the EWAC's bias and precision varied across population subgroups:

- the simple deviation $(\text{EWAC}-\text{GF})$ was regressed in a linear model to test subgroup differences in MD
- the squared deviation $(\rm{EWAC}-\rm{GF})^2$ was regressed in a log-transformed linear model to test subgroup differences in the geometric mean squared deviation. Model coefficients were then back-transformed (square root of the exponential) into relative RMSD estimates; these are interpreted as the ratio of the subgroup RMSD to the reference RMSD, a ratio >1 indicating worse precision than in the reference category.

Both models (supplementary table S5.1) included the following predictors: sex by age group; ethnic group; highest educational qualification; religion; smoking status. Additional models (supplementary table S5.2) were fitted solely in respondents with an AUDIT-C score $\geq$ 5 or an AUDIT score $\geq$ 8, for whom additional characteristics were recorded during interview: favourite drink (beer; wine; spirits alone; mixed spirits; cider; other); and whether the respondent had attempted to restrict alcohol intake in the last 12 months.

### Receiver Operating Characteristics

We tested the EWAC's superiority to the traditional AUDIT and AUDIT-C scores in predicting consumption exceeding 14 or 35 UK units/week. These correspond to UK thresholds for characterising alcohol use as 'increasing risk' (predicted by an AUDIT-C score of 5–7), and 'higher risk' (AUDIT-C score $\geq$ 8) which is above 35 units for women and 50 units for men [@Lavoie2010]. We tested the hypothesis that the EWAC has an identical receiver operating characteristic full area under the curve (AUC) to the AUDIT-C and the full AUDIT scores using nonparametric paired AUC tests [@Delong1988]. AUDIT-C and AUDIT scores were calculated from the Extended AUDIT by capping the contribution of each question to 4.

### Aggregate concurrent validity

We compared the empirical cumulative distributions of (1) the EWAC computed in the Alcohol Toolkit Study; (2) the GF estimator in the Alcohol Toolkit Study; (3) the beverage-specific estimator in the 2011 Health Survey for England; (4) the prospective diary estimator in the 2011 Health Survey for England in adults aged $\geq$ 18 years. A $\chi^2$ test of homogeneity of distributions (1) and (3) was performed on contingency tables of 13 drinking consumption intervals in UK units/week (]0,5]; ]5,10]; ...; ]30,35]; ]35,45]; ]45,55]; ]55,65]; ]65,75]; ]75,100]; ]100,200]). We report the proportions of on-trade and off-trade alcohol sales [@PHE2017] accounted for by each method.

Poststratification survey weights adjusted for nonresponse bias in sources (1-3), and self-selection into prospective diary data collection in source (4).

# Results

```{r}

ats$ewac_mp <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_midpoints, method = "qfv")
ats$ewac_qf <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN, method = "qf")
ats$ewac_qfv <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN, method = "qfv")
ats$ewac_qb <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN, method = "qb")
ats$ewac_qv <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN, method = "qv")
ats$ewac_qfv_M <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN_men, method = "qfv")
ats$ewac_qfv_F <- proc_EWAC(ats[, auditx_labels],
                           audit_coef = audit_weights_STAN_women, method = "qfv")
ats <- mutate(ats, ewac_qfv_S = if_else(sex == "Men", 
                                        ewac_qfv_M, ewac_qfv_F))

ats$ewac_best <- data.frame(list(ats$gfmeanweekly - ats$ewac_qf, ats$gfmeanweekly - ats$ewac_qv, ats$gfmeanweekly - ats$ewac_qfv, ats$gfmeanweekly - ats$ewac_qb)) %>% 
  apply(., 1, function(X) if(length(which.min(abs(X)))==0) NA else which.min(abs(X))) 

ats$ewac_best<- factor(ats$ewac_best, labels = c("qf", "qv", "qfv", "qb"))


test_midpoint <- list(
  MD = mean(ats$ewac_mp - ats$gfmeanweekly, na.rm = T),
  MD.ME = 1.96 * sqrt(var(ats$ewac_mp - ats$gfmeanweekly, na.rm = T) / (
    length(na.omit(ats$ewac_mp - ats$gfmeanweekly)) - 1)),
  MD.p = t.test.MD(ats$ewac_mp - ats$gfmeanweekly)$p.value,
  RMSD = sqrt(mean((ats$ewac_mp - ats$gfmeanweekly)^2, na.rm = T)),
  MSD = (mean((ats$ewac_mp - ats$gfmeanweekly)^2, na.rm = T)),
  MSD.ME = 1.96 * sqrt(var((ats$ewac_mp - ats$gfmeanweekly)^2, na.rm = T) / (
    length(na.omit(ats$ewac_mp - ats$gfmeanweekly))) - 1 ),
  RMSD.p = t.test( (ats$ewac_mp - ats$gfmeanweekly)^2, mu = 4)$p.value
)

test_stan <- list(
  MD = mean(ats$ewac_qfv - ats$gfmeanweekly, na.rm = T),
  MD.ME = 1.96 * sqrt(var(ats$ewac_qfv - ats$gfmeanweekly, na.rm = T) / (
    length(na.omit(ats$ewac_qfv - ats$gfmeanweekly)) - 1)),
  MD.p = t.test.MD(ats$ewac_qfv - ats$gfmeanweekly)$p.value,
  MSD = (mean((ats$ewac_qfv - ats$gfmeanweekly)^2, na.rm = T)),
  MSD.ME = 1.96 * sqrt(var((ats$ewac_qfv - ats$gfmeanweekly)^2, na.rm = T) / (
  length(na.omit(ats$ewac_qfv - ats$gfmeanweekly))) - 1 ),
  RMSD = sqrt(mean((ats$ewac_qfv - ats$gfmeanweekly)^2, na.rm = T)),
  RMSD.p = chisq.test.variance( (ats$ewac_qfv - ats$gfmeanweekly)^2,
                                sigma = 4)$p.value
)

test_stan_S <- list(
  MD = mean(ats$ewac_qfv_S - ats$gfmeanweekly, na.rm = T),
  MD.p = t.test.MD(ats$ewac_qfv_S - ats$gfmeanweekly)$p.value,
  RMSD = sqrt(mean((ats$ewac_qfv_S - ats$gfmeanweekly)^2, na.rm = T)),
  RMSD.p = chisq.test.variance( (ats$ewac_qfv_S - ats$gfmeanweekly)^2,
                                sigma = 4)$p.value
)

stan_qfv_S_men <- ats %>% 
  filter(sex == "Men") %>% 
  summarise(MD = mean(ewac_qfv_S - gfmeanweekly, na.rm = T),
            MD.p = t.test.MD(ewac_qfv_S - gfmeanweekly)$p.value,
            RMSD = sqrt(mean((ewac_qfv_S - gfmeanweekly)^2, na.rm = T)),
            RMSD.p = chisq.test.variance((ewac_qfv_S - gfmeanweekly)^2,
                                         sigma = 4)$p.value) 
stan_qfv_S_women <- ats %>% 
  filter(sex == "Women") %>% 
  summarise(MD = mean(ewac_qfv_S - gfmeanweekly, na.rm = T),
            MD.p = t.test.MD(ewac_qfv_S - gfmeanweekly)$p.value,
            RMSD = sqrt(mean((ewac_qfv_S - gfmeanweekly)^2, na.rm = T)),
            RMSD.p = chisq.test.variance((ewac_qfv_S - gfmeanweekly)^2,
                                         sigma = 4)$p.value)

```

## Bias and precision

EWAC coefficients estimated empirically (supplementary information S1, S4) had smaller bias and error and were used for the remainder of the analysis. With those, the EWAC's Pearson's correlation with GF was estimated at $r$ = `r tbrounding(cor.test(ats$gfmeanweekly, ats$ewac_qfv, use = "complete.obs")$estimate,2)` [`r paste(tbrounding(cor.test(ats$gfmeanweekly, ats$ewac_qfv, use = "complete.obs")$conf.int, 2), collapse = ", ")`] (Kendall's rank correlation $\tau$ = `r suppressWarnings(tbrounding(cor.test(ats$gfmeanweekly, ats$ewac_qfv, use = "complete.obs", method = "kendall")$estimate, 2))`).

The mean deviation (MD) was `r tbrounding(test_stan$MD, 1)` alcohol units/week [95% CI: `r round(test_stan$MD - test_stan$MD.ME, 2)`, `r round(test_stan$MD + test_stan$MD.ME, 1)`]. This bias is smaller than the preregistered $\pm$ 1-unit bias tolerance (`r pvrounding(test_stan$MD.p)`). 

The root mean squared deviation (RMSD), at `r tbrounding(test_stan$RMSD, 1)` units/week [95% CI: `r tbrounding(sqrt(test_stan$MSD - test_stan$MSD.ME), 1)`, `r tbrounding(sqrt(test_stan$MSD + test_stan$MSD.ME), 1)`], was significantly greater than the pre-registered 2-unit total error tolerance (`r pvrounding(test_stan$RMSD.p)`), suggesting that the EWAC falls on average 11 units away from the GF reference standard.

The RMSD masked a dispersed and skewed distribution of error (`r table_nums('tab_ats_rmsd_quantiles', display = "cite")`). In 50% of participants, the EWAC fell within $\pm$ 2.1 UK units of the GF weekly consumption estimate. Thus, an interval defined as the EWAC $\pm$ 2 units (e.g. '10 to 14 units') would contain the reference standard for half of individuals, while an interval ranging $\pm$ 3 units (e.g. '9 to 15 units') would contain the reference standard for 60% of individuals. 

`r table_nums('tab_ats_rmsd_quantiles')`

```{r ats_rmsd_quantiles}
t(tbrounding(quantile(na.omit(abs(ats$ewac_qfv - ats$gfmeanweekly)), probs = c(seq(.1, .9, .1), .95, .99)), 1)) %>% data.frame()
```

Plots of EWAC against GF (`r fig_nums("fig_scatter_ats", display = "cite")`) indicate a slight positive bias for consumptions up to 10-14 units/week, and a slight negative bias beyond. The EWAC only starts losing granularity above 70 units/week (99th percentile of its distribution), where it provides just 6 possible values (82; 83; 92; 93; 100; 125 units/week; see `r fig_nums("fig_scatter_ats", display = "cite")`(b)).


```{r supptabRMSD}
# mutate(ats, 
#        `EWAC interval` = cut(ewac_qfv, 
#                     breaks = c(0, 5, 10, 20, 30, 45, 60, 75, 100, 150, 400),
#                     right = F)) %>% 
#   filter(!is.na(gfmeanweekly) & !is.na(ewac_qfv)) %>% 
#   group_by(`EWAC interval`) %>% 
#   summarise(RMSD = round(sqrt(mean((ewac_qfv - gfmeanweekly)^2, na.rm = T)), 1),
#             n = formatbm(n()))

```


```{r ewac_benchmark}
ats$ewac_qfv_bench <- ats$ewac_qfv * 0.8997 + 0.8344

stan_qfv_bench <- ats %>% 
  summarise(MD = mean(ewac_qfv_bench - gfmeanweekly, na.rm = T),
            RMSD = sqrt(mean((ewac_qfv_bench - gfmeanweekly)^2, na.rm = T)),
            RMSD.p = chisq.test.variance((ewac_qfv_bench - gfmeanweekly)^2,
                                         sigma = 4)$p.value)
```



```{r warning=F, fig.height=5, fig.width=10, message=FALSE}
scatterplot_1 <- dplyr::select(ats, gfmeanweekly, ewac_qfv) %>% 
  na.omit %>% 
  ggplot(mapping = aes(x = gfmeanweekly, y = ewac_qfv)) +
  geom_point(alpha = .1) +
  geom_abline(aes(intercept = 0, slope = 1, col = "Identity", linetype = "Identity")) +
  geom_smooth(aes(col="OLS", linetype = "OLS"), method ='lm', formula=y~x) +
  geom_smooth(aes(col="Spline", linetype = "Spline"), 
              method = 'gam', formula = y~s(x, bs="ts")) +
  scale_colour_manual(name="Line of fit",
    values = c("Identity" = "black", "OLS" = "blue", "Spline" = "red")) +
  scale_linetype_manual(name="Line of fit",
    values = c("Identity" = "solid", "OLS" = "longdash", "Spline" = "dotted")) +
  ylab("EWAC (UK units/week)") +
  xlab("Graduated-Frequency schedule (UK units/week)") +
  coord_equal() +
  geom_hline(yintercept = 14, color = "grey50") + 
  geom_vline(xintercept = 14, color = "grey50") +
  theme_bw()

scatterplot_1b <- scatterplot_1 +
  geom_rect(aes(xmin = 0, ymin = 0, xmax = 36, ymax = 36), fill = "#faf207") +
  geom_point(alpha = .1)+
  scale_x_continuous(breaks = seq(0, 150, 10), limits = c(0, 150), minor_breaks = F)+
  scale_y_continuous(breaks = seq(0, 150, 10), limits = c(0, 150), minor_breaks = F)+
  ggtitle("(b)")

scatterplot_1a <- scatterplot_1 +
  theme(panel.background = element_rect(fill = "#faf207"),
        panel.grid = element_line(colour = "white")) +
 scale_x_continuous(breaks = seq(0, 150, 2), limits = c(0, 35), minor_breaks = F)+
 scale_y_continuous(breaks = seq(0, 150, 2), limits = c(0, 35), minor_breaks = F)+
  ggtitle("(a)")

plotfig_scatter_ats <- ggpubr::ggarrange(scatterplot_1a, 
                                         scatterplot_1b, 
                                         ncol = 2, nrow = 1)

plotfig_scatter_ats
```

`r fig_nums('fig_scatter_ats')`

```{r include=FALSE}
pdf("figures/fig_scatter_ats.pdf", 10, 5)
plotfig_scatter_ats
dev.off()
```


Extensive subgroup analyses are reported in supplementary material 5. A very modest proportion of variation in bias and precision (<5%) can be attributed to socio-demographic variables under examination. This indicates a relative homogeneity in precision in bias, to one exception. The EWAC appears to overestimate consumption by 1 to 2 UK units in groups with the lowest average consumption: women, and Non-British White, Black, and Other ethnic groups.

## Receiver Operating Characteristics

```{r, roc112_compute, message=F}
roc_auditc <- pROC::roc(gfmeanweekly>=14 ~ auditc, data = ats)  
roc_ewac <- pROC::roc(gfmeanweekly>=14 ~ ewac_qfv, data = ats)
roc_audit <- pROC::roc(gfmeanweekly>=14 ~ fullaudit, data = ats)

roc_results <- list()
roc_results$auditc <- as_tibble(list(
  `Index test` = "AUDIT-C score",
  AUC = as.numeric(pROC::auc(roc_auditc)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc_auditc)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc_auditc))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc_auditc, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc_auditc, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc_auditc, "b", transpose = F)$specificity
))
roc_results$audit <- as_tibble(list(
  `Index test` = "Full AUDIT score",
  AUC = as.numeric(pROC::auc(roc_audit)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc_audit)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc_audit))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc_audit, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc_audit, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc_audit, "b", transpose = F)$specificity
))
roc_results$ewac <- as_tibble(list(
  `Index test` = "EWAC",
  AUC = as.numeric(pROC::auc(roc_ewac)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc_ewac)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc_ewac))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc_ewac, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc_ewac, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc_ewac, "b", transpose = F)$specificity
))

roc_results <- bind_rows(roc_results) %>% 
  mutate(AUC = round(AUC, 3),
         `Best threshold` = round(`Best threshold`, 1),
         Sensitivity = round(Sensitivity, 3),
         Specificity = round(Specificity, 3))
roc_ewac_nominal14 <- pROC::coords(roc_ewac, 14, transpose = F)
```


```{r, roc280_compute, message=F}
roc280_auditc <- pROC::roc(gfmeanweekly>=35 ~ auditc, data = ats)  
roc280_ewac <- pROC::roc(gfmeanweekly>=35 ~ ewac_qfv, data = ats)
roc280_audit <- pROC::roc(gfmeanweekly>=35 ~ fullaudit, data = ats)


roc280_results <- list()
roc280_results$auditc <- as_tibble(list(
  `Index test` = "AUDIT-C score",
  AUC = as.numeric(pROC::auc(roc280_auditc)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc280_auditc)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc280_auditc))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc280_auditc, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc280_auditc, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc280_auditc, "b", transpose = F)$specificity
))
roc280_results$audit <- as_tibble(list(
  `Index test` = "Full AUDIT score",
  AUC = as.numeric(pROC::auc(roc280_audit)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc280_audit)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc280_audit))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc280_audit, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc280_audit, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc280_audit, "b", transpose = F)$specificity
))
roc280_results$ewac <- as_tibble(list(
  `Index test` = "EWAC",
  AUC = as.numeric(pROC::auc(roc280_ewac)),
  `95% CI` = paste0("[", round(as.numeric(ci(pROC::auc(roc280_ewac)))[1], 3), ", ",
                    round(as.numeric(ci(pROC::auc(roc280_ewac))), 3)[3], "]"),
  `Best threshold` = pROC::coords(roc280_ewac, "b", transpose = F)$threshold,
  Sensitivity = pROC::coords(roc280_ewac, "b", transpose = F)$sensitivity,
  Specificity = pROC::coords(roc280_ewac, "b", transpose = F)$specificity
))
roc280_results <- bind_rows(roc280_results) %>% 
  mutate(AUC = round(AUC, 3),
         `Best threshold` = round(`Best threshold`, 1),
         Sensitivity = round(Sensitivity, 3),
         Specificity = round(Specificity, 3))
roc280_ewac_nominal <- pROC::coords(roc280_ewac, 35, transpose = F)
```

We examined the EWAC's ability to predict consumption exceeding 14 or 35 UK units/week. The full areas under the receiver operating characteristic curves (AUC, supplementary Figure S6) are presented along sensitivity and specificity at the best thresholds in Tables `r table_nums("tab_study1_roc112", display = "n")`–`r table_nums("tab_study1_roc280", display = "n")`.

**14 UK units/week (increasing-risk)**: EWAC increases the AUC by 5 percentage points compared to the AUDIT-C score (`r pvrounding(roc.test(roc_auditc, roc_ewac, method = "delong")$p.value)`); and 7 percentage points compared to the full AUDIT score (`r pvrounding(roc.test(roc_audit, roc_ewac, method = "delong")$p.value)`). The cut-off maximising the sum of specificity and sensitivity on the EWAC is 10 units/week. The sensitivity at this threshold is identical to AUDIT-C, but specificity gains 13 percentage points. Using the nominal cut-off of 14 units/week on the EWAC raises specificity to `r round(roc_ewac_nominal14$specificity, 3)`, at the cost of a reduction in sensitivity to `r round(roc_ewac_nominal14$sensitivity, 3)` (`r table_nums("tab_study1_roc112", display = "cite")`).

`r table_nums('tab_study1_roc112')`

```{r tab_roc112}
roc_results
```

*Note*: The best threshold refers the cut-off value that maximises the sum of sensitivity and specificity.

**35 units/week (higher-risk)**: EWAC provides small increases in AUC compared with the AUDIT-C score (`r pvrounding(roc.test(roc280_auditc, roc280_ewac, method = "delong")$p.value)`) and the full AUDIT score (`r pvrounding(roc.test(roc280_audit, roc280_ewac, method = "delong")$p.value)`). The best cut-off for detecting consumption in excess of 35 units/week using the EWAC was 17 units/week (`r table_nums("tab_study1_roc280", display = "cite")`).


`r table_nums('tab_study1_roc280')`

```{r tab_roc280}
roc280_results
```

*Note*: The best threshold refers the cut-off value that maximises the sum of sensitivity and specificity.




## Empirical distribution

```{r exclude_under18}
# From this point onwards, only drinkers aged 18 years and over
hse_dk18 <- filter(hse, age >= 18 & dnnow == 1) # only those drinking 'at all these days'
ats_dk18 <- filter(ats, actage >= 18 & audit1 > 1) %>%  # not 'never' drinkers
  mutate(agg_qfv = ewac_qfv)

alc_unit_cutoffs <- c(seq(0, 35, 5), 45, 55, 65, 75, 100, 200)

chisquare_homogeneity_data <- full_join(
  filter(ats_dk18, !is.na(agg_qfv)) %>% 
    mutate(alc_unit_bin = cut(agg_qfv, breaks = alc_unit_cutoffs),
         N = n(),
         pw = weighttns13/sum(weighttns13)) %>% 
    group_by(alc_unit_bin) %>% 
    summarise(ewac_ess = round( sum(pw) * N))  %>% 
    na.omit() %>% distinct(),
  filter(hse_dk18, !is.na(totalwu)) %>% 
    mutate(alc_unit_bin = cut(totalwu, breaks = alc_unit_cutoffs),
           N = n(),
           pw = wt_int/sum(wt_int)) %>% 
    group_by(alc_unit_bin) %>% 
    summarise(hse_ess = round( sum(pw) * N)) %>% 
    na.omit() %>% distinct(),
  by = "alc_unit_bin"
) %>% 
  mutate(ewac_ess = tidyr::replace_na(ewac_ess, 0))
chisquare_homogeneity_results <- chisq.test(chisquare_homogeneity_data[, 2:3])

ats_dk18_female <- dplyr::filter(ats_dk18, sex == "Women") %>% 
  dplyr::select(agg_qfv, weighttns13) %>% 
  na.omit()
ats_dk18_male <- dplyr::filter(ats_dk18, sex == "Men") %>% 
  dplyr::select(agg_qfv, weighttns13) %>% 
  na.omit()

ewac_ecdf_female <- spatstat.geom::ewcdf(ats_dk18_female$agg_qfv,
                                    ats_dk18_female$weighttns13)
ewac_ecdf_male <- spatstat.geom::ewcdf(ats_dk18_male$agg_qfv,
                                  ats_dk18_male$weighttns13)

write.csv(as.data.frame(quantile(ewac_ecdf_female, 
                                 probs = c(seq(0, 0.9, 0.02), 
                                           seq(0.91, 1, 0.005)))),
          file = "../04_suppmat/EWAC_percentiles_females.csv")
write.csv(as.data.frame(quantile(ewac_ecdf_male, 
                                 probs = c(seq(0, 0.9, 0.02), 
                                           seq(0.91, 1, 0.005)))),
          file = "../04_suppmat/EWAC_percentiles_males.csv")
```


`r table_nums("tab_aggregate_summary_stats", display = "cite")` estimates adult residents' total alcohol consumption in England using four different sources, and compares them with alcohol retail sales. The Health Survey for England exhibits the highest estimates and coverage of alcohol sales. EWAC amounts to `r round((sum(ats_dk18$agg_qfv * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T))/(sum(hse_dk18$weektot * hse_dk18$wt_drink, na.rm =T)/sum(hse_dk18$wt_drink, na.rm =T))*100)`% of the total consumption estimated by the Health Survey for England's prospective diary, and `r round(sum(ats_dk18$agg_qfv * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T)*100/alcohol_pcapita_drinker_2014_units)`% of retail sales.

`r table_nums('tab_aggregate_summary_stats')`

| Study     | Mean (units/week)     | Median | Variance | N | % of alcohol sold |
| ----------| ---------------------:| --------:|--------:| ----: | -----:
| Health Survey for England beverage-specific QF      | `r tbrounding(sum(hse_dk18$totalwu * hse_dk18$wt_int, na.rm =T)/sum(hse_dk18$wt_int, na.rm =T))`  |   `r tbrounding(median(hse_dk18$totalwu, na.rm =T))`  | `r tbrounding(var(hse_dk18$totalwu, na.rm =T))` |  `r formatbm(sum(!is.na(hse_dk18$totalwu)))` | `r tbrounding(sum(hse_dk18$totalwu * hse_dk18$wt_int, na.rm =T)/sum(hse_dk18$wt_int, na.rm =T)*100 / alcohol_pcapita_drinker_2014_units)` |
| Health Survey for England prospective diary | `r tbrounding(sum(hse_dk18$weektot * hse_dk18$wt_drink, na.rm =T)/sum(hse_dk18$wt_drink, na.rm =T))`   | `r tbrounding(median(hse_dk18$weektot, na.rm =T))`     | `r tbrounding(var(hse_dk18$weektot, na.rm =T))` |  `r formatbm(sum(!is.na(hse_dk18$weektot)))` |`r tbrounding(sum(hse_dk18$weektot * hse_dk18$wt_drink, na.rm =T)/sum(hse_dk18$wt_drink, na.rm =T)*100/alcohol_pcapita_drinker_2014_units)` |
| Alcohol Toolkit Study GF    | `r tbrounding(sum(ats_dk18$gfmeanweekly * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T))`   | `r tbrounding(median(ats_dk18$gfmeanweekly, na.rm =T))`   | `r tbrounding(var(ats_dk18$gfmeanweekly, na.rm =T))` |  `r formatbm(sum(!is.na(ats_dk18$gfmeanweekly)))` |`r tbrounding(sum(ats_dk18$gfmeanweekly * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T)*100/alcohol_pcapita_drinker_2014_units)` |
| Alcohol Toolkit Study EWAC    | `r tbrounding(sum(ats_dk18$agg_qfv * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T))`   | `r tbrounding(median(ats_dk18$agg_qfv, na.rm =T))`   | `r tbrounding(var(ats_dk18$agg_qfv, na.rm =T))` |  `r formatbm(sum(!is.na(ats_dk18$agg_qfv)))` |`r tbrounding(sum(ats_dk18$agg_qfv * ats_dk18$weighttns13, na.rm =T)/sum(ats_dk18$weighttns13, na.rm =T)*100/alcohol_pcapita_drinker_2014_units)` |
| Retail sales | `r tbrounding(alcohol_pcapita_drinker_2014_units)` | -- | -- | -- | -- |

`r fig_nums('fig_ECDF', display = "cite")` suggests that the EWAC, like the Alcohol Toolkit Study GF, estimates a greater prevalence of lower-risk ($\leq$ 14 units/week) and increasing-risk alcohol use than Health Survey for England. It shows a clear departure between the EWAC and the Health Survey for England's beverage specific questionnaire, as evidence by the homogeneity test ($\chi^2_{12}$= `r formatbm(round(chisquare_homogeneity_results$statistic,1))`, $p$ `r format.pval( chisquare_homogeneity_results$p.value, eps = 0.001)`).

```{r ggplot_ECDF, warning=F, message=F, fig.height=4, fig.width=5}
plotfig_ECDF <- ggplot() + 
  stat_ecdf(aes(gfmeanweekly, 
                colour = "Alcohol Toolkit Study Graduated Frequency", 
                linetype = "Alcohol Toolkit Study Graduated Frequency"), 
            data = ats_dk18, weight = ats_dk18$weighttns13, 
            geom = "step", na.rm =T, lwd=.5) +
  stat_ecdf(aes(agg_qfv, 
                colour = "Alcohol Toolkit Study EWAC", 
                linetype = "Alcohol Toolkit Study EWAC"),
            data = ats_dk18,  weight = ats_dk18$weighttns13, 
            geom = "step", lwd = .5) +
  stat_ecdf(aes(totalwu, 
                colour = "Health Survey for England Quantity-Frequency", 
                linetype = "Health Survey for England Quantity-Frequency"),
            data = hse_dk18, weight = hse_dk18$wt_int, 
            geom = "step", lwd = .5) +
  stat_ecdf(aes(weektot, 
                colour = "Health Survey for England Diary", 
                linetype = "Health Survey for England Diary"),
            data = hse_dk18, weight = hse_dk18$wt_drink, lwd = .5) +
  scale_y_continuous(name = "Empirical cumulative density",
                     breaks = seq(0, 1, .1)) +
  scale_x_continuous(name = "Average units/week",
                     limits = c(0, 100),
                     breaks = seq(0, 500, 10),
                     minor_breaks = seq(0, 500, 5))+
  geom_vline(xintercept = 14) +
  annotate(geom = "text", x = 16.5, y = .16, 
           label = "14 units/week", angle = 90) +
  theme_bw() +
  scale_colour_manual(
    name = "Estimator",
    values = c("Alcohol Toolkit Study Graduated Frequency" = "darkorange",
               "Alcohol Toolkit Study EWAC" = "black",
               "Health Survey for England Quantity-Frequency" = "darkorchid2",
               "Health Survey for England Diary" = "darkorchid4")) +
  scale_linetype_manual(name = "Estimator",
                        values = c(5, 1, 3, 1)) +
  theme(legend.position = c(.64, 0.2),
        legend.text = element_text(size=9))

plotfig_ECDF
```

```{r include=FALSE}
pdf("figures/fig_ECDF.pdf", 5, 4)
plotfig_ECDF
dev.off()
```

`r fig_nums('fig_ECDF')`



# Discussion

## Main findings

We developed a continuous Estimator of Weekly Alcohol Consumption (EWAC) using a 6-month Extended AUDIT-C. When compared with a 4-week GF reference standard, we found EWAC had a positive bias of 0.2 UK units [0.08, 0.4], and that deviations were highly skewed: while the mean error was ±11 UK units/week [9.5, 11.9], in half of participants the deviation between EWAC and GF was between 0 and ±2.1 UK units/week. EWAC is superior to both the AUDIT-C and the full AUDIT in predicting GF exceeding 14 units/week (AUC = 0.92) and 35 units/week (AUC = 0.93). This places the EWAC among the best-performing diagnostic tools examined in the most recent systematic review [@DeMeneses-Gaya2009]. At the 14-unit threshold, an EWAC >= 10 cut-off has a sensitivity of 0.87, compared to a 0.75 for an AUDIT-C >= 5 cut-off, without losing specificity.

## Potential applications

Being equivalent or superior to the AUDIT in speed, accuracy, and international standardisation, the EWAC <https://ewac.netlify.app> appears suitable for use in clinical practice to support brief interventions and to feed back a reliable 4-unit wide interval estimate of alcohol consumption (eg: '9-13 units/week' or '70-100 g/week').

Nutt, Rehm *et al.* [@Nutt2014; @Rehm2016] argued that alcohol-related harm is best prevented if individuals know their consumption level, and health professionals in all settings can engage patients effectively to manage risks with evidence-based interventions, in a similar way to other risk factors for disease, for example blood pressure or cholesterol. Knowledge of alcohol beverage content is generally poor [@Mongan2015], and many countries have not adopted a measure of standard drinks [@Kalinowski2016]. A survey evaluating the 2016 change in UK alcohol guidelines found that just 8% of the UK drinkers knew the new recommended limits [@Rosenberg2018]. The EWAC can support interventions focusing on recognising the alcohol content and volume of drinks.

The EWAC's dimensional rather than categorical format can avoid the stigma sometimes associated with clinical categorisations of alcohol use disorders. Assessment of alcohol consumption is not well embedded in clinical practice [@Browne2016]. The EWAC calculator fills a gap in resources by transforming the answers from the Extended AUDIT-C into an estimate of an individual's weekly alcohol consumption. This is a more directly accessible metric which should facilitate behaviour change by empowering people to monitor and control their alcohol consumption with--or without--the involvement of healthcare professionals.

The EWAC is particularly suitable for digital interventions and healthcare records given that it enables its complex algorithm to be embedded in a way not possible with paper records. EWAC is already compatible with medical records information models developed in the Systematised Nomenclature of Medicine Clinical Terms (SNOMED CT, Alcohol intake (observable entity) [@SNOMED-UK]) and by the English Royal College of Physicians [@RCP2018]. Such information can have secondary uses as a variable in other disease risk scores, or to prospectively recording of long-term alcohol exposure, an important risk factor for a range of medical conditions.

## Strengths and limitations 

This paper is the first to (a) develop an EWAC using a well-accepted and validated alcohol screening tool such as the AUDIT; and (b) quantify its bias and precision with respect to a continuous measure of alcohol consumption. One study [@Rubinsky2013] previously reported mean consumption by AUDIT-C score, but without quantifying bias or precision of such a measure. Others have evaluated the AUDIT-C's accuracy in estimating alcohol consumption, but exclusively in relation to predicting consumption in excess of predefined thresholds [@DeMeneses-Gaya2009].

Our study provides strong confidence in the internal and external validity of findings in England on account of the large sample size and extensive range of subgroup analyses reported. Bias was mostly consistent across subgroups examined (age/sex, education, smoking status, religion), with one exception. EWAC overestimated alcohol consumption by 2-3 UK units/week in Black/Other ethnic groups. Variation in the sensitivity of AUDIT-C across ethnic groups has previously been noted in the US [@Frank2008].

Repurposing a well-known tool such as the AUDIT-C has several advantages. It is already translated in many languages and adapted to the varying standard drink sizes adopted internationally [@Babor2001]. The Extended AUDIT scores can be converted into traditional AUDIT scores by capping items to 4, thereby offering a point of comparison with existing evidence. The AUDIT's properties are also well understood in diverse contexts and modes of administration, based on the last 30 years of international research. For instance, a previous study which found the AUDIT-C to be responsive to changes of 70g/week [@Bradley1998] can suggest that the EWAC's own responsiveness to change should be equivalent, if not greater than the AUDIT-C's, given the Extended AUDIT-C's additional response items.

We note two main study limitations. First, a longstanding obstacle in alcohol research and treatment lies in the absence of undisputed 'gold standard' or biomarker for objectively determining alcohol consumption. Instead, a number of instruments measure self-reported consumption with varying validity and reliability over different durations. Comprehensive reviews [@Heeb2005; @Livingston2015; @Rehm1998; @Stockwell2004; @Stockwell2014; @Stockwell2016] indicate that yesterday recall and prospective diaries tend to record higher (and more accurate) alcohol consumption by minimising recall bias, followed by GF measures.

Therefore, the GF reference standard, as all self-reported measures, is imperfect. While this has no effect on our measure of bias (MD), this may introduce bias into our measure of prescision (RMSD): by definition, the reference standard's own independent error will inflate the RMSD. In other words, it is likely that a proportion of the RMSD is attributable to error in the GF measures rather than the EWAC. 

Despite this, previous research suggests the EWAC's agreement with GF (Pearson's correlation coefficient $r$ = 0.71 and Kendall's rank correlation $\tau$ = 0.63 in the present study) is comparable to the agreement between GF and prospective diaries measured from past studies($r$ ~ 0.86--0.89 [@Greenfield2009; @Hilton1989]; $\tau$ = 0.41 [@Heeb2005]).

Second, the EWAC's design does not escape all limitations of methods of screening or categorising alcohol use disorders. The conceptualisation of alcohol use disorders is related to, but does not exclusively depend upon the amount of alcohol consumed. Since Jellinek's description of 'the disease concept of alcoholism' [@Jellinek1960] there have been numerous attempts to categorise the range of phenotypes characterising alcohol use disorders in the absence of any biomarker to 'verify' the presence of a particular pathology. The EWAC, by limiting itself to an estimation of alcohol consumption is transparent across a wide range of alcohol use disorders but does not measure the other factors underpinning this complex and heterogeneous condition [@Leggio2009; @Saunders2019].

In conclusion, the EWAC has the potential to support interventions focusing on recognising the alcohol content and volume of drinks. The EWAC's dimensional rather than categorical format may facilitate this while avoiding the stigma sometimes associated with clinical categorisations of alcohol use disorders.


# Declarations 

## Acknowledgements

This research was supported by the Medical Research Council [grant reference MR/P016960/1]. The Alcohol Toolkit Study data collection was funded primarily by the National Institute for Health Research (NIHR) School for Public Health Research [grant reference SPHR‐SWP‐ALC‐WP5] and Public Health Research Programme [grant reference 15/63/01]. The EWAC online calculator development was funded by the Wessex Academic Health Science Network. The views expressed are those of the author(s) and not necessarily those of the NHS, the NIHR or the Department of Health. 

## Ethics

This study was approved by the University of Southampton's Faculty of Medicine Ethics Committee (ERGO 44682).
 
## Consent for publication

Not applicable.

## Competing interests

JB has received unrestricted research funding to study smoking cessation from companies who manufacture smoking cessation medications. PD, JH and JMAS declare no competing interests.


# Supplementary information

## Supplementary information S1: Bayesian model report (PDF file)

A model was fitted on the dataset with respondents completing the full Extended AUDIT-C (*n*= `r formatbm( n_ats_validaudit)`; excluding those answering AUDIT-1 with 'Never'), entering AUDIT-C answers, the EWAC, and socio-demographic variables commonly associated with either nonresponse or alcohol consumption. Table XX below reports the most parsimonious model, after testing for some interactions and removing variables inflating the Akaike Information Criterion. We find evidence that the Graduated Frequency data is missing not at random.
 
```{r missingness_tests, results='asis'}
ats_complete_data <- ats_complete_data %>% 
  mutate(GF_missing = case_when(
    audit1 == 1 | is.na(audit1_label) | is.na(audit2_label) | is.na(audit3_label) ~ NA_integer_,
    is.na(gfmeanweekly) ~ 1L,
    TRUE ~ 0L
  ),
  audit1_label = factor(
    audit1_label,
    levels = c("Never", "Monthly or less",
               "2 to 4 times a month", "2 to 3 times a week", 
               "4 to 5 times a week", "6 or more times a week")),
  audit2_label = factor(
    audit2_label,
    levels = c("1 to 2", "3 to 4", "5 to 6", "7 to 9", 
               "10 to 12", "13 to 15", "16 or more")
  ),
  audit3_label = factor(
    audit3_label,
    levels = c("Never", "Less than monthly", "Monthly", "Weekly", "Daily or almost daily")
  ))
ats_complete_data$ewac_qfv <- proc_EWAC(ats_complete_data[, auditx_labels],
                                        audit_coef = audit_weights_STAN, method = "qfv")
glm_gf_missing <- glm(
  GF_missing ~ audit1_label+ audit2_label+ audit3_label+ ewac_qfv +
    factor(marital) + factor(tennet) + smokstat + 
    sex + ageg + ethgrp + highqual + religion +weighttns13, 
    family = binomial(link = "logit"),
    data = ats_complete_data
)
glm_gf_missing
# sjPlot::tab_model(glm_gf_missing, digits = 3,
#                   df.method = "wald",
#                   show.se = T, show.ci = F,
#                   show.reflvl = TRUE )
# stargazer::stargazer(glm_gf_missing,
#           type = ifelse(knit_output_pdf, "latex", "html"),
#           digits = 3, digits.extra	= 0, initial.zero = T,
#           single.row = T, intercept.bottom = F, align=TRUE, no.space= T,
#           report = "vcsp*")
```


```{r missingness_pattern,  fig.height=5, fig.width=25}
# dplyr::filter(ats_complete_data, !is.na(GF_missing)) %>%
#   dplyr::select(
#     gfmeanweekly, audit1_label, audit2_label, audit3_label,
#     ewac_qfv, sex, ageg, ethgrp, highqual,
#     marital, tennet, religion, smokstat
#   ) %>%
#   mice::md.pattern(rotate.names = T)

ats_imputed <- ats %>%
  filter( !(audit1 == 1 | is.na(audit1_label) | is.na(audit2_label) | is.na(audit3_label)) ) %>%
  dplyr::transmute(
    gfmeanweekly, audit1_label, audit2_label, audit3_label,
    ewac_qfv, sex, ageg, ethgrp, highqual,
    marital = as.factor(marital), 
    tennet = as.factor(tennet), 
    religion, smokstat
  ) %>%
  mice::mice(m = 20, seed = 1957, print = FALSE)

imputed_deviations <- mice::complete(ats_imputed, "long") %>%
  transmute(.imp,
            deviation  = ewac_qfv - gfmeanweekly,
            sqdeviation = (ewac_qfv - gfmeanweekly)^2)
MD_imp_sens <- MKmisc::mi.t.test(
  split(imputed_deviations, f = imputed_deviations$.imp),
  x = "deviation", alternative = "greater", mu = 1
)
```

To examine the influence of GF data missingness on our validation data, we performed a sensitivity analysis using multiple imputation with chained equations (MICE) on the primary outcomes of the study: mean deviation and root mean square deviation in the validation sample. Using 20 imputations and default imputation methods (predictive mean matching for GF, polytomous regression imputation for the remaining categorical variables), we found:

* MD = `r round(mean(imputed_deviations$deviation), 2)` UK units/week with imputation, compared to `r round(mean(ats$ewac_qfv - ats$gfmeanweekly, na.rm = T), 2)` without imputation.
* RMSD = `r round(sqrt(mean(imputed_deviations$sqdeviation)), 2)` UK units/week with imputation, compared to `r round(sqrt(mean((ats$ewac_qfv - ats$gfmeanweekly)^2, na.rm = T)), 2)` without imputation.

There results being very similar, multiple imputation was not employed in the study.


## Supplementary information S2: Alcohol Toolkit Study Extended AUDIT questionnaire schedule

## Supplementary information S3: Alcohol Toolkit Study Graduated-Frequency questionnaire schedule

## Supplementary Table S4: EWAC coefficients (CSV file)

## Supplementary information S5: Analysis of subgroup variation in bias and error

```{r ewac_subgroup_regressions}
ats <- mutate(ats, f_ageg = relevel(ageg7, ref = "25-34 years"))

lm_bias_stan <- lm((ewac_qfv-gfmeanweekly) ~ sex*f_ageg + ethgrp +  
                    religion + highqual  + smokstat, data = ats)
lm_rmsd_stan <- lm(log((ewac_qfv-gfmeanweekly)^2) ~ sex*f_ageg + ethgrp +  
                    religion + highqual + smokstat, data = ats)
lm_bias_increasingrisk <- lm((ewac_qfv-gfmeanweekly) ~ sex*f_ageg + ethgrp + 
                   religion + highqual + smokstat + favdrink + tryalclyc2, 
                   data = filter(ats, auditc >= 5 | fullaudit >=8))
lm_rmsd_increasingrisk <- lm(log((ewac_qfv-gfmeanweekly)^2) ~ sex*f_ageg + ethgrp + 
                   religion + highqual + smokstat + favdrink + tryalclyc2, 
                   data = filter(ats, auditc >= 5 | fullaudit >=8))
```

MDs and RMSDs were regressed against respondent characteristics to identify potential subgroup differences in bias or precision from the reference category (White British males aged 25–34 years without educational qualifications, who never smoked). Model predictors accounted for <5% of the variance, indicating stability in MD and RMSD across subgroups (tables S5.1-S5.2).

Figure S5.1 shows subgroups with a predicted MD exceeding $\pm$ 1 unit/week and a coefficient $p$-value<0.05. Respondents of Black/Other/White Other ethnic groups had an overestimated EWAC: their MDs exceeded the reference MD by 1.7 units [0.4, 2.9]; 2.3 units [0.1, 4.4]; and 1.0 units [0.3, 1.7] respectively. MDs of men aged 55–64 years, or $\geq$ 75 years exceeded the reference MD by 1.1 units [0.2, 2.0] and 1.0 units [0.02, 2.0] respectively. Recent attempts to reduce alcohol intake in increasing-risk drinkers were associated with a modest underestimation in EWAC by 0.9 UK units [0.1, 1.6] (Table S5.2).

```{r ewac_subgroup_bias, fig.width=7, fig.height=3}
ewac_bias_plot <- as_tibble(summary(lm_bias_stan)$coefficients)
ewac_bias_plot <- ewac_bias_plot %>% 
  mutate(Variable = names(lm_bias_stan$coefficients),
         MD = lm_bias_stan$coefficients[1] + Estimate) %>% 
  filter(abs(MD)>=1 & `Pr(>|t|)` < 0.05) %>% 
  arrange(-Estimate) %>% 
  mutate(x = rank(Estimate))
  
labs <- ewac_bias_plot$Variable
names(labs) <- as.character(length(labs):1)

plotfig_ewac_MD_forest_plot <- ggplot(ewac_bias_plot, aes(x = factor(x), y = MD)) +
  scale_x_discrete(breaks = names(labs), 
                   labels = labs, name = NULL)+
  scale_y_continuous(breaks = -10:16, name = "Predicted MD (UK units/week)")+
  coord_flip() +
  geom_linerange(aes(ymin = MD - 1.96*`Std. Error`, ymax = MD + 1.96*`Std. Error`), 
                 colour = "purple") +
  geom_point() +
  geom_text(aes(label = round(MD, 1)), vjust = 1.2) +
  geom_hline(aes(yintercept = 0)) +
  geom_segment(aes(x = "0", xend = "0", y =0, yend = 2), 
               lwd = 1, arrow = arrow(length = unit(0.03, "npc"))) +
  geom_label(aes(x = "0", y = 0.1, 
                 label = "EWAC overestimates consumption"),
             hjust = "left", nudge_x = 0.5 ,colour = "purple") +
  theme_minimal() 

plotfig_ewac_MD_forest_plot
```

*Figure S5.1:* Forest plot of modelled MD for selected subgroups

```{r include=FALSE}
pdf("figures/fig_ewac_MD_forest_plot.pdf", 7, 3)
plotfig_ewac_MD_forest_plot
dev.off()
```

Figure S5.2 shows subgroups with an RMSD at least 25% smaller/greater than the reference. RMSD was 53% [44%, 63%] greater in current smokers and 45% [21%, 75%] greater in respondents who stopped smoking in the past year. It was also 43% [27%, 62%] and 41% [24%, 60%] greater respectively in men and respondents aged 16–24 years. In contrast, error was 20 to 40% smaller in Black/Asian/Other/White Other ethnic groups.


```{r ewac_subgroup_error, fig.width=9, fig.height=3}
ewac_error_plot <- as_tibble(summary(lm_rmsd_stan)$coefficients)
ewac_error_plot <- ewac_error_plot %>% 
  mutate(Variable = names(lm_rmsd_stan$coefficients),
         RMSD_ratio = sqrt(exp(Estimate))) %>% 
  mutate(RMSD_ratio_LB = sqrt(exp(Estimate - (1.96*`Std. Error`))),
         RMSD_ratio_UB = sqrt(exp(Estimate + (1.96*`Std. Error`)))) %>% 
  filter(abs(Estimate)>=log(1.25^2) & `Pr(>|t|)` < 0.05 & Variable != "(Intercept)") %>% 
  arrange(-RMSD_ratio) %>% 
  mutate(x = formatC(rank(RMSD_ratio)+1, width = 2, format = "d", flag = "0"))
  
labs2 <- ewac_error_plot$Variable
names(labs2) <- as.character(ewac_error_plot$x)

plotfig_ewac_RMSD_forest_plot <- ggplot(ewac_error_plot, 
                                        aes(x = factor(x), y = RMSD_ratio)) +
  scale_x_discrete(breaks = names(labs2), 
                   labels = labs2, name = NULL)+
  scale_y_continuous(breaks = seq(0, 4, .1),
                     "Relative RMSD (1.0 = reference category)")+
  coord_flip() +
  geom_text(aes(label = round(RMSD_ratio, 1)), vjust = 1.2) +
  geom_linerange(aes(ymin = RMSD_ratio_LB, ymax = RMSD_ratio_UB), colour = "purple") +
    geom_point() +
  geom_hline(aes(yintercept = 1)) +
  geom_segment(aes(x = "00", xend = "00", y =1, yend =1.25), 
               lwd = 1, arrow = arrow(length = unit(0.03, "npc"))) +
  geom_label(aes(x = "00", y = 1.01, label = "Worse agreement of EWAC\n with reference standard"),
             hjust = "inward", vjust= -0.2, colour = "purple") +
  theme_minimal() 

plotfig_ewac_RMSD_forest_plot
```
*Figure S5.2:* Forest plot of RMSD ratio (selected subgroups to reference category)

```{r include=FALSE}
pdf("figures/fig_ewac_RMSD_forest_plot.pdf", 7, 3)
plotfig_ewac_RMSD_forest_plot
dev.off()
```

Figure S5.3 presents the same metrics for increasing-/higher-risk drinkers (AUDIT-C $\geq$ 5 or AUDIT $\geq$ 8). Educational qualifications significantly improved the agreement between EWAC and the reference standard in this group (Table S5.2). School and degree-level qualifications reduced RMSD by 22% [12%, 31%] and 28% [19%, 37%] respectively, suggesting that respondents may have better recall and clarity over alcohol beverage content.

```{r ewac_subgroup_error_increasedrisk, fig.width=9, fig.height=3}
ewac_error_plot_increasedrisk <- as_tibble(summary(lm_rmsd_increasingrisk)$coefficients)
ewac_error_plot_increasedrisk <- ewac_error_plot_increasedrisk %>% 
  mutate(Variable = names(lm_rmsd_increasingrisk$coefficients),
         RMSD_ratio = sqrt(exp(Estimate))) %>% 
  mutate(RMSD_ratio_LB = sqrt(exp(Estimate - (1.96*`Std. Error`))),
         RMSD_ratio_UB = sqrt(exp(Estimate + (1.96*`Std. Error`)))) %>% 
  filter(abs(Estimate)>=log(1.25^2) & `Pr(>|t|)` < 0.05 & Variable != "(Intercept)") %>% 
  arrange(-RMSD_ratio) %>% 
  mutate(x = formatC(rank(RMSD_ratio)+1, width = 2, format = "d", flag = "0"))
  
labs2 <- ewac_error_plot_increasedrisk$Variable
names(labs2) <- as.character(ewac_error_plot_increasedrisk$x)

plotfig_ewac_RMSD_increasedrisk_forest_plot <- ggplot(ewac_error_plot_increasedrisk, aes(x = factor(x), y = RMSD_ratio)) +
  scale_x_discrete(breaks = names(labs2), 
                   labels = labs2, name = NULL)+
  scale_y_continuous(breaks = seq(0, 4, .1),
                     "Relative RMSD (1.0 = reference category)")+
  coord_flip() +
  geom_text(aes(label = round(RMSD_ratio, 1)), vjust = 1.2) +
  geom_linerange(aes(ymin = RMSD_ratio_LB, ymax = RMSD_ratio_UB), colour = "purple") +
    geom_point() +
  geom_hline(aes(yintercept = 1)) +
  geom_segment(aes(x = "00", xend = "00", y =1, yend =1.25), 
               lwd = 1, arrow = arrow(length = unit(0.03, "npc"))) +
  geom_label(aes(x = "00", y = 1.01, label = "Worse agreement of EWAC\n with reference standard"),
             hjust = "inward", vjust= -0.2, colour = "purple") +
  theme_minimal() 

plotfig_ewac_RMSD_increasedrisk_forest_plot
```

*Figure S5.3:* Forest plot of RMSD ratio (selected subgroups to reference category) in respondents with a hazardous/harmful alcohol use (AUDIT-C>=5 or AUDIT>=8) 

```{r include=FALSE}
pdf("figures/fig_ewac_RMSD_increasedrisk_forest_plot.pdf", 7, 3)
plotfig_ewac_RMSD_increasedrisk_forest_plot
dev.off()
```

`r fig_nums('fig_ewac_RMSD_increasedrisk_forest_plot')`


Table S5.1: Coefficients of linear regression of subgroup bias and error of EWAC compared with GF in all respondents (n = `r formatbm(valid_n_study1b)`)


```{r, results='asis'}
stargazer::stargazer(#lm_bias_mp, lm_rmsd_mp, 
          lm_bias_stan, lm_rmsd_stan, 
          type = ifelse(knit_output_pdf, "latex", "html"),
          ci = rep(T, 2),
          digits = 1, digits.extra	= 1, initial.zero = T, style = "ajs",
          single.row = T, intercept.bottom = F, align=TRUE, no.space= T,
          report = "vcs*")

```

```{r export_CSV_coefficients}
results_lm_all_MD <- data.frame(summary(lm_bias_stan)$coefficients)
results_lm_all_MD$Variable <- row.names(results_lm_all_MD)
results_lm_all_MD <- results_lm_all_MD %>% 
  transmute(Variable,
            MD_coef = Estimate,
            MD_LB = Estimate - 1.96 * `Std..Error`,
            MD_UB = Estimate + 1.96 * `Std..Error`,
            MD_SE = `Std..Error`,
            MD_pvalue = `Pr...t..`)

results_lm_all_MSD <- data.frame(summary(lm_rmsd_stan)$coefficients)
results_lm_all_MSD$Variable <- row.names(results_lm_all_MSD)
results_lm_all_MSD <- results_lm_all_MSD %>% 
  transmute(Variable,
            log_MSD_coef = Estimate,
            log_MSD_SE = `Std..Error`,
            log_MSD_pvalue = `Pr...t..`,
            Relative_RMSD = sqrt(exp(Estimate)),
            Relative_RMSD_LB = sqrt(exp(Estimate - 1.96 * `Std..Error`)),
            Relative_RMSD_UB = sqrt(exp(Estimate + 1.96 * `Std..Error`))
            )

results_lm_increasing_MD <- data.frame(summary(lm_bias_increasingrisk)$coefficients)
results_lm_increasing_MD$Variable <- row.names(results_lm_increasing_MD)
results_lm_increasing_MD <- results_lm_increasing_MD %>% 
  transmute(Variable,
            MD_coef = Estimate,
            MD_LB = Estimate - 1.96 * `Std..Error`,
            MD_UB = Estimate + 1.96 * `Std..Error`,
            MD_SE = `Std..Error`,
            MD_pvalue = `Pr...t..`)

results_lm_increasing_MSD <- data.frame(summary(lm_rmsd_increasingrisk)$coefficients)
results_lm_increasing_MSD$Variable <- row.names(results_lm_increasing_MSD)
results_lm_increasing_MSD <- results_lm_increasing_MSD %>% 
  transmute(Variable,
            log_MSD_coef = Estimate,
            log_MSD_SE = `Std..Error`,
            log_MSD_pvalue = `Pr...t..`,
            Relative_RMSD = sqrt(exp(Estimate)),
            Relative_RMSD_LB = sqrt(exp(Estimate - 1.96 * `Std..Error`)),
            Relative_RMSD_UB = sqrt(exp(Estimate + 1.96 * `Std..Error`))
            )

for (i in list("results_lm_all_MD", "results_lm_all_MSD", 
         "results_lm_increasing_MD", "results_lm_increasing_MSD")) {
  write.csv(get(i), file = paste0("../04_suppmat/", i, ".csv"), row.names = F)
}

```


Table S5.2: Coefficients of linear regression of the subgroup bias and error of EWAC compared with GF in respondents with a hazardous/harmful alcohol use (AUDIT-C>=5 or AUDIT>=8; (n = `r formatbm(valid_n_study1c)`)

```{r, results='asis'}
stargazer::stargazer(#lm_bias_mp, lm_rmsd_mp, 
          lm_bias_increasingrisk, lm_bias_increasingrisk, 
          type = ifelse(knit_output_pdf, "latex", "html"),
          ci = rep(T, 2),
          digits = 1, digits.extra	= 1, initial.zero = T, style = "ajs",
          single.row = T, intercept.bottom = F, align=TRUE, no.space= T,
          report = "vcs*")

```




## Supplementary information S6: Receiver operating characteristics curves

```{r roc_curves_112, fig.height=5, fig.width=7}
# roc_auditc$linetype <- "solid"
# roc_auditc$colour <- "#70ee9c"
# roc_ewac$linetype <- "longdash"
# roc_ewac$colour <- "#434371"



thresholds_auditc <- pROC::coords(roc_auditc, x = seq(3.5, 6.5, 1), 
                          input = "threshold", transpose = F)
thresholds_auditc$name <- "AUDIT-C score"
thresholds_auditc$`Cut-off` <- if_else(thresholds_auditc$threshold == 4.5, 
                                  "Max sens. & spec.", "Other")

thresholds_ewac <- pROC::coords(roc_ewac, x = c(8, 10, 12), 
                          input = "threshold", transpose = F) 
thresholds_ewac$name <- "EWAC"
thresholds_ewac$`Cut-off` <- if_else(thresholds_ewac$threshold == 10, 
                                  "Max sens. & spec.", "Other")

thresholds_audit <- pROC::coords(roc_audit, x = seq(4.5, 6.5, 1), 
                          input = "threshold", transpose = F) 
thresholds_audit$name <- "Full AUDIT score"
thresholds_audit$`Cut-off` <- if_else(thresholds_audit$threshold == 5.5, 
                                  "Max sens. & spec.", "Other")

plotfig_ROC_112g <- ggroc(list("EWAC" = roc_ewac,
           "AUDIT-C score" = roc_auditc, 
           "Full AUDIT score" = roc_audit), 
      aes=c("linetype", "colour")) + 
  geom_point(mapping = aes(x = specificity, y = sensitivity, shape = `Cut-off`),
             data = bind_rows(thresholds_ewac, thresholds_auditc, thresholds_audit),
             size = 2.5, stroke = 1.2, col = "black") +
  geom_text(data = bind_rows(thresholds_ewac, thresholds_auditc, thresholds_audit),
            aes(x = specificity, y = sensitivity, label = threshold),
            hjust= -0.2, vjust = -0.2) +
  scale_shape_manual(values = c(4, 1, 3) ) +
  ggtitle("Consumption >= 112g/week")

plotfig_ROC_112g
write.csv(pROC::coords(roc_auditc, transpose = F),
          file = "../04_suppmat/ROC/roc_112g_auditc.csv", row.names = F)
write.csv(pROC::coords(roc_audit, transpose = F),
          file = "../04_suppmat/ROC/roc_112g_full_audit.csv", row.names = F)
write.csv(pROC::coords(roc_ewac, transpose = F),
          file = "../04_suppmat/ROC/roc_112g_ewac.csv", row.names = F)
```


```{r roc_curves_280, fig.height=5, fig.width=7}
# roc_auditc$linetype <- "solid"
# roc_auditc$colour <- "#70ee9c"
# roc_ewac$linetype <- "longdash"
# roc_ewac$colour <- "#434371"

thresholds280_auditc <- pROC::coords(roc280_auditc, x = seq(5.5, 7.5, 1), 
                          input = "threshold", transpose = F)
thresholds280_auditc$name <- "AUDIT-C score"
thresholds280_auditc$`Cut-off` <- if_else(thresholds280_auditc$threshold == 6.5, 
                                  "Max sens. & spec.", "Other")

thresholds280_ewac <- pROC::coords(roc280_ewac, x = c(14, 17, 19), 
                          input = "threshold", transpose = F) 
thresholds280_ewac$name <- "EWAC"
thresholds280_ewac$`Cut-off` <- if_else(thresholds280_ewac$threshold == 17, 
                                  "Max sens. & spec.", "Other")

thresholds280_audit <- pROC::coords(roc280_audit, x = seq(5.5, 7.5, 1), 
                          input = "threshold", transpose = F) 
thresholds280_audit$name <- "Full AUDIT score"
thresholds280_audit$`Cut-off` <- if_else(thresholds280_audit$threshold == 6.5, 
                                  "Max sens. & spec.", "Other")

plotfig_ROC_280g <- ggroc(list("EWAC" = roc280_ewac,
           "AUDIT-C score" = roc280_auditc, 
           "Full AUDIT score" = roc280_audit), 
      aes=c("linetype", "colour")) + 
  geom_point(mapping = aes(x = specificity, y = sensitivity, shape = `Cut-off`),
             data = bind_rows(thresholds280_ewac, thresholds280_auditc, thresholds280_audit),
             size = 2.5, stroke = 1.2, col = "black") +
  geom_text(data = bind_rows(thresholds280_ewac, thresholds280_auditc, thresholds280_audit),
            aes(x = specificity, y = sensitivity, label = threshold),
            hjust= -0.5, vjust = 0.4) +
  scale_shape_manual(values = c(4, 1, 3) ) +
  ggtitle("Consumption >= 280g/week") +
  coord_cartesian(xlim = c(1, .5), ylim = c(.5, 1))

plotfig_ROC_280g
write.csv(pROC::coords(roc280_auditc, transpose = F),
          file = "../04_suppmat/ROC/roc_280g_auditc.csv", row.names = F)
write.csv(pROC::coords(roc280_audit, transpose = F),
          file = "../04_suppmat/ROC/roc_280g_full_audit.csv", row.names = F)
write.csv(pROC::coords(roc280_ewac, transpose = F),
          file = "../04_suppmat/ROC/roc_280g_ewac.csv", row.names = F)

```

```{r include=FALSE}
pdf("figures/fig_ROC_112g.pdf", 7, 5)
plotfig_ROC_112g
dev.off()
pdf("figures/fig_ROC_280g.pdf", 7, 5)
plotfig_ROC_280g
dev.off()
```

## Supplementary information S7: Demographic characteristics and alcohol consumption descriptives

```{r, message = FALSE, results="asis"}
arsenal::tableby(
  `Alcohol consumption (units/week, GF estimate)` ~ Gender + Age + `Ethnic group` + 
    `Highest qualification`+ `AUDIT-C score` + `Full AUDIT score` + `Favourite drink` + `Attempt to cut down`, 
  control = arsenal::tableby.control(
    test = FALSE, 
    numeric.stats = c("Nmiss", "meansd"),
    digits = 1L),
  data = dplyr::mutate(
    dplyr::filter(ats_complete_data, sexz %in% c(1,2)),
    `Alcohol consumption (units/week, GF estimate)` = dplyr::case_when(
      audit1 == 1 ~ "Never drinks (AUDIT-1 = 0)",
      gfmeanweekly < 14 ~ "<14",
      gfmeanweekly >= 14 & gfmeanweekly < 35 ~ "14-34",
      gfmeanweekly >= 35 & gfmeanweekly < 50 ~ "35-50",
      gfmeanweekly >= 50 ~ "50-400",
      TRUE ~ "Missing"),
    Gender = sex,
    Age = ageg7,
    `Ethnic group` = ethgrp,
    `Highest qualification` = highqual,
    `Favourite drink` = favdrink,
    `Attempt to cut down` = tryalclyc2,
    `AUDIT-C score` = cut(auditc, breaks = c(0, 1, 5, 8, 12), include.lowest = T, right = F),
    `Full AUDIT score` = cut(fullaudit, breaks = c(0, 1, 8, 16, 20, 40), include.lowest = T, right = F))
  ) %>% summary()
```

## Supplementary information S8: STARD Checklist


# References